
# disk

æ¯«ä¸å¤¸å¼ çš„è¯´, ç¡¬ç›˜å ªç§°æœºæ¢°å·¥ç¨‹çš„ä¸€ä¸ªå¥‡è¿¹!

![disks](https://raw.githubusercontent.com/learner-lu/picbed/master/disks.gif)

> ä¸€ä¸ªéå¸¸å¥½çš„ç¡¬ç›˜æœºæ¢°ç»“æ„å¯è§†åŒ–çš„è§†é¢‘: [How do Hard Disk Drives Work?  ğŸ’»ğŸ’¿ğŸ› ](https://www.youtube.com/watch?v=wtdnatmVdIg)

## ç¡¬ç›˜ç»“æ„

ç¡¬ç›˜ç”±åŒ…æ‹¬ç£ç›˜ã€ä¸»è½´ã€å¤´å †å ç»„ä»¶ã€æ»‘å—å’Œè¯»å†™å¤´ç­‰å¾ˆå¤šä¸ªéƒ¨åˆ†ç»„æˆ, å…¶ä¸­æœ€é‡è¦çš„æ˜¯ä¸¤ä¸ªéƒ¨ä»¶æ˜¯**ç£ç›˜**å’Œ**ç£å¤´**

![20240415171941](https://raw.githubusercontent.com/learner-lu/picbed/master/20240415171941.png)

ç£ç›˜å›ºå®šåœ¨ä¸»è½´ä¸Š,ç”±ä¸­å¿ƒçš„æ— åˆ·ç›´æµç”µæœºé©±åŠ¨,ä»¥7200è½¬/åˆ†é’Ÿçš„é€Ÿåº¦æ—‹è½¬.å¤´å †å ç»„ä»¶ä½äºæ¯ä¸ªç£ç›˜çš„ä¸Šä¸‹ä¸¤ç«¯,åŒ…å«ä¸€ä¸ªæ»‘å—å’Œè¯»å†™å¤´.æ»‘å—åˆ©ç”¨ç£ç›˜æ—‹è½¬äº§ç”Ÿçš„æ°”æµ,ä½¿è¯»å†™å¤´æ‚¬æµ®åœ¨ç£ç›˜è¡¨é¢ä»…15çº³ç±³çš„é«˜åº¦,å®ç°ç²¾ç¡®è¯»å†™.

![20240507104100](https://raw.githubusercontent.com/learner-lu/picbed/master/20240507104100.png)

ç£å¤´çš„éŸ³åœˆç”µæœºç”±çº¿åœˆå’Œä¸Šä¸‹ä¸¤ä¸ªç£é“ç»„æˆ,ç”¨äºç§»åŠ¨è‡‚æ¶ç»„ä»¶.å½“ç”µæµé€šè¿‡çº¿åœˆæ—¶ä¸ç£é“ç›¸äº’ä½œç”¨äº§ç”ŸåŠ›,ä½¿è¯»å†™å¤´åœ¨ç£ç›˜ä¸Šç§»åŠ¨.åå‘ç”µæµä½¿è¯»å†™å¤´åå‘ç§»åŠ¨.é€šè¿‡ç²¾ç¡®æ§åˆ¶ç”µæµ,è¯»å†™å¤´çš„ä½ç½®å¯ä»¥åœ¨30nmèŒƒå›´å†…è°ƒæ•´.è¿™ç§å¼ºå¤§çš„é©¬è¾¾è®¾è®¡ä½¿è½»å‹è‡‚æ¶ç»„ä»¶å’Œè¯»å†™å¤´èƒ½å¤Ÿä»¥æ¯ç§’20æ¬¡çš„é€Ÿåº¦åœ¨ç›˜ç‰‡ä¸Šå¿«é€Ÿç§»åŠ¨,å¹¶è¿›è¡Œå¾®å°çš„è°ƒæ•´.

![20240507114439](https://raw.githubusercontent.com/learner-lu/picbed/master/20240507114439.png)

ç£ç›˜åŒ…å«å¾ˆå¤šä¸ªç›˜ç‰‡, æ¯ä¸€ä¸ªç›˜ç‰‡æœ‰**ä¸¤é¢**, åœ¨é€»è¾‘ä¸Šè¢«åˆ’åˆ†ä¸ºç£é“ã€æŸ±é¢ä»¥åŠæ‰‡åŒº.

- ç£ç›˜åœ¨æ ¼å¼åŒ–æ—¶è¢«åˆ’åˆ†æˆè®¸å¤š**åŒå¿ƒåœ†**,è¿™äº›åŒå¿ƒåœ†è½¨è¿¹å«åš**ç£é“**(Track),ç£é“ä»å¤–å‘å†…ä»0å¼€å§‹é¡ºåºç¼–å·;
- **æ‰€æœ‰ç›˜é¢ä¸Šçš„åŒä¸€ç£é“æ„æˆä¸€ä¸ªåœ†æŸ±**,é€šå¸¸ç§°åš**æŸ±é¢**(Cylinder),æ¯ä¸ªåœ†æŸ±ä¸Šçš„ç£å¤´ç”±ä¸Šè€Œä¸‹ä»"0"å¼€å§‹ç¼–å·;
- æ¯ä¸ªç£é“ä¼šè¢«åˆ†æˆè®¸å¤šæ®µ**åœ†å¼§**,æ¯æ®µåœ†å¼§å«åšä¸€ä¸ª**æ‰‡åŒº**,æ‰‡åŒºä»"1"å¼€å§‹ç¼–å·,æ¯ä¸ªæ‰‡åŒºä¸­çš„æ•°æ®ä½œä¸ºä¸€ä¸ªå•å…ƒåŒæ—¶è¯»å‡ºæˆ–å†™å…¥,æ“ä½œç³»ç»Ÿä»¥æ‰‡åŒº(Sector)å½¢å¼å°†ä¿¡æ¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Š,æ¯ä¸ªæ‰‡åŒºåŒ…æ‹¬**512**ä¸ªå­—èŠ‚çš„æ•°æ®å’Œä¸€äº›å…¶ä»–ä¿¡æ¯

![20240507104130](https://raw.githubusercontent.com/learner-lu/picbed/master/20240507104130.png)

è¿™é‡Œä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜, **ä¸åŒç£é“çš„æ‰‡åŒºæ•°æ˜¯å¦ç›¸åŒ?** ä¸Šå›¾æ˜¯æ—§çš„è®°å½•æ–¹å¼,çš„ç¡®æ¯ä¸ªç£é“æ‰€æ‹¥æœ‰çš„æ‰‡åŒºæ•°é‡éƒ½æ˜¯ä¸€æ ·çš„. ä½†æ˜¯æˆ‘ä»¬æ³¨æ„åˆ°éšç€åŠå¾„çš„å¢åŠ , **è¶Šå¤–ä¾§æ‰‡åŒºçš„é¢ç§¯è¶Šå¤§**, åŒæ—¶å› ä¸ºä¸»è½´æ—‹è½¬çš„è§’é€Ÿåº¦ä¸å˜, **è¶Šå¤–ä¾§è½¬åŠ¨çš„é€Ÿåº¦è¶Šå¿«**(çº¿é€Ÿåº¦å¤§). å› ä¸ºæ¯ä¸ªæ‰‡åŒºæ‰€èƒ½å®¹çº³çš„æ•°æ®é‡æ˜¯ç›¸åŒçš„,éƒ½æ˜¯512å­—èŠ‚,è€Œæ•°æ®é‡éœ€è¦å¹³å‡åˆ†é…åœ¨æ‰‡åŒºé¢ç§¯çš„æ¯ä¸ªè§’è½,æ‰€ä»¥å¤–é¢æ‰‡åŒºçš„æ•°æ®å¯†åº¦ä½,é‡Œé¢æ‰‡åŒºçš„æ•°æ®å¯†åº¦é«˜

![20240507110234](https://raw.githubusercontent.com/learner-lu/picbed/master/20240507110234.png)

è¿™æ ·ç»“æœæ˜¯æµªè´¹äº†å¤–å›´æ‰‡åŒºçš„å¤§é¢ç§¯,æ‰€ä»¥æœ‰äº†å¦å¤–ä¸€ç§è§£å†³æ–¹æ¡ˆ,åˆ†åŒºè®°å½•æ–¹å¼ (zone bit recording, [ZBR](https://en.wikipedia.org/wiki/Zone_bit_recording)). æ–°çš„è§£å†³æ–¹å¼è®¤ä¸º,æ—¢ç„¶ç£ç›˜è¶Šå¾€å¤–é¢ç§¯è¶Šå¤§,é‚£å°±åº”è¯¥åˆ’åˆ†å‡ºæ›´å¤šçš„æ‰‡åŒº,æ¯ä¸ªæ‰‡åŒºçš„é¢ç§¯éƒ½æ˜¯ä¸€æ ·çš„,å®¹çº³çš„æ•°æ®é‡ä¹Ÿæ˜¯ä¸€æ ·çš„. å¯ä»¥çœ‹åˆ°ä¸‹å›¾ä¸­å¤–ä¾§çš„æ‰‡åŒºæ•°å¯ä»¥è¿›è¡Œå€å¢.

![20240507110638](https://raw.githubusercontent.com/learner-lu/picbed/master/20240507110638.png)

ä¸‹å›¾æ˜¯ä¸€ä¸ªç£ç›˜çš„æµ‹è¯•ç»“æœ, å…¶ä¸­æ¨ªåæ ‡ä»£è¡¨ç£é“ä½ç½®, 0% è¡¨ç¤ºæœ€å¤–ä¾§, 100% è¡¨ç¤ºæœ€é‡Œä¾§, çº¢çº¿å’Œè“çº¿åˆ†åˆ«ä»£è¡¨å†™é€Ÿåº¦å’Œè¯»é€Ÿåº¦. å¯ä»¥å¾ˆæ˜æ˜¾çš„éªŒè¯æˆ‘ä»¬çš„ç»“è®º: è¶Šé è¿‘å†…ä¾§è¯»å†™é€Ÿåº¦è¶Šæ…¢

![20240508104626](https://raw.githubusercontent.com/learner-lu/picbed/master/20240508104626.png)

ä¸ºä»€ä¹ˆç¡¬ç›˜ç”¨ä¹…äº†è¯»å†™é€Ÿåº¦ä¼šå˜æ…¢? å› ä¸ºç£ç›˜çš„å†™å…¥çš„æ–¹å¼æ˜¯ä»å¤–åˆ°å†…,å…ˆå†™æ»¡æœ€å¤–çš„ç£é“,æ¥ç€å†å†™é‡Œé¢çš„ç£é“. å‰é¢æˆ‘ä»¬æåˆ°å› ä¸ºä¸»è½´æ—‹è½¬çš„è§’é€Ÿåº¦ä¸å˜, æ‰€ä»¥**è¶Šå¤–ä¾§è½¬åŠ¨çš„é€Ÿåº¦è¶Šå¿«**(çº¿é€Ÿåº¦å¤§), å› æ­¤åŒæ ·çš„æ—¶é—´,**è¯»å†™å¤´åœ¨å¤–é¢ç£é“æ‰«è¿‡çš„æ‰‡åŒºæ•°é‡è¦æ›´å¤š**, åæ˜ å‡ºæ¥çš„æ˜¯å°±æ˜¯**è¯»å†™é€Ÿåº¦æ›´å¿«**. ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥è¿›è¡Œç£ç›˜æ•´ç†æˆ–è€…æ ¼å¼åŒ–,è¿™ä¼šä½¿å¤–é¢çš„ç£é“å¾—åˆ°ä½¿ç”¨

## è¯»å†™

æ—©æœŸçš„çºµå‘ç£è®°å½•æŠ€æœ¯ä¸­,ç£æ€§é¢—ç²’çš„æ˜“ç£åŒ–æ–¹å‘ä¸ç£ç›˜**å¹³è¡Œ**,é¢—ç²’æ²¿åœ†å‘¨æ’åˆ—,å¯èƒ½å‡ºç°SSå’ŒNNçš„äº’æ–¥æ’åˆ—.éšç€é¢—ç²’å°ºå¯¸å‡å°å’Œå¯†åº¦å¢åŠ ,é¢—ç²’å¯¹çƒ­è¿åŠ¨æ•æ„Ÿ,æ˜“å¤±å»ç¨³å®šæ€§,å¯¼è‡´æ•°æ®æŸå.

![20240327202619](https://raw.githubusercontent.com/learner-lu/picbed/master/20240327202619.png)

ç”±äºç°ä»Šç¡¬ç›˜çš„èµ„æ–™è®°å½•åŒºå—å¤§å°å·²ç»å‘å±•åˆ°å®½åº¦åªæœ‰30çº³ç±³å·¦å³,è€Œç£æ€§è®°å½•é¢—ç²’çš„å°ºå¯¸ä¸æ–­ä¸‹é™,ä½†ç¡¬ç›˜å®¹é‡å€æ•°ä¸Šå‡,å¯¼è‡´å‡ºç°ç”µç£å­¦ä¸Šçš„è¶…é¡ºç£æ•ˆåº”(è¶…é¡ºç£æ€§),å¤§å¤§é™ä½äº†ç¡¬ç›˜çš„å®¹é‡æå‡æ½œåŠ›.å› æ­¤ä¸ºäº†é…åˆç”µè„‘æŠ€æœ¯å‘å±•,æœ‰å…¬å¸å¼€å§‹å‘å±•è¿ç”¨**å‚ç›´ç£è®°å½•æŠ€æœ¯**çš„ç¡¬ç›˜

> è¶…é¡ºç£æ€§æ˜¯æŒ‡å½“æŸäº›å…·æœ‰ç£æ€§çš„é¢—ç²’å°äºæŸä¸ªå°ºå¯¸æ—¶,å¤–åœºäº§ç”Ÿçš„ç£å–å‘åŠ›å¤ªå°è€Œæ— æ³•æŠµæŠ—çƒ­æ‰°åŠ¨çš„å¹²æ‰°,è€Œå¯¼è‡´å…¶ç£åŒ–æ€§è´¨ä¸é¡ºç£ä½“ç›¸ä¼¼

å‚ç›´ç£è®°å½•æŠ€æœ¯é€šè¿‡ä½¿é¢—ç²’çš„æ˜“ç£åŒ–æ–¹å‘ä¸ç£ç›˜**å‚ç›´**,ä½¿ç”¨å•æç£å¤´å’Œè½¯ç£å±‚äº§ç”Ÿçš„é—´éš™ç£åœºå†™å…¥ä¿¡æ¯,æ¯”çºµå‘æŠ€æœ¯äº§ç”Ÿçš„ç£åœºå¼ºä¸¤å€.è¿™å…è®¸ä½¿ç”¨æ›´å¼ºç£å„å‘å¼‚æ€§çš„ææ–™,æé«˜å­˜å‚¨å¯†åº¦.

é€šè¿‡æ”¹å˜ç”µæµæ–¹å‘å¯ä»¥æ§åˆ¶ç£å¤´çš„ç£åœºæ–¹å‘, è¿›è€Œå½±å“åˆ°ä¸‹æ–¹ç£ç•´ç£æ€§æ–¹å‘æ¥å®ç°å†™å…¥æ•°æ®. **è™½ç„¶ä½¿ç”¨ N-S/S-N æ¥åŒºåˆ† 1bit çš„ 0/1 æ¯”è¾ƒç®€å•, ä½†å…¶å®æƒ…å†µå¹¶éå¦‚æ­¤**. å‚ç›´ç£è®°å½•æŠ€æœ¯ä¸­,è¯»å–å¤´è¢«è®¾è®¡ä¸º**æ£€æµ‹ç£åœºæ–¹å‘çš„å˜åŒ–**.ç›¸é‚»çš„ç£æ€§åŒºåŸŸåœ¨åˆ‡æ¢æ–¹å‘æ—¶äº§ç”Ÿçš„ç£åœºå˜åŒ–è¿œå¼ºäºå•ä¸€æ–¹å‘çš„ç£åœº,å› æ­¤è¯»å–å¤´å¯ä»¥å‡†ç¡®è¯†åˆ«è¿™äº›å˜åŒ–.æ¯ä¸ªç£åœºæ–¹å‘çš„å˜åŒ–(ä»æŒ‡å‘ä¸€ä¸ªæ–¹å‘åˆ°æŒ‡å‘ç›¸åæ–¹å‘)è¢«ç¼–ç ä¸º1,è€Œä»ä¸€ä¸ªç£æ€§åŒºåŸŸåˆ°ä¸‹ä¸€ä¸ªç›¸é‚»åŒºåŸŸçš„è¿‡æ¸¡åˆ™è¢«ç¼–ç ä¸º0,ä»è€Œå®ç°äº†æ•°æ®çš„è¯»å–.

![20240507125321](https://raw.githubusercontent.com/learner-lu/picbed/master/20240507125321.png)

## å¯»å€

CHS(Cylinder-Head-Sector)æ˜¯ä¸€ç§æ—©æœŸç¡¬ç›˜å¯»å€æ–¹æ³•,é€šè¿‡å‚ç›´çš„ç£å¤´ã€æ°´å¹³çš„åœ†æŸ±ä½“å’Œè§’åæ ‡çš„æ‰‡åŒºæ„æˆä¸‰ç»´åæ ‡ç³»æ¥å®šä½æ•°æ®å—.ç£å¤´é€‰æ‹©ç›˜ç‰‡çš„ä¸€ä¸ªè¡¨é¢,åœ†æŸ±ä½“ä»£è¡¨ç›˜ç‰‡å †å çš„åœ†æŸ±å½¢äº¤å‰ç‚¹,è€Œæ‰‡åŒºåˆ™ç»†åˆ†ç£é“ä¸ºç­‰å¤§å°çš„å¼§å½¢éƒ¨åˆ†.CHSå¯»å€å› æ—©æœŸç¡¬ç›˜ç¼ºä¹åµŒå…¥å¼æ§åˆ¶å™¨è€Œè®¾è®¡,è¦æ±‚æ“ä½œç³»ç»Ÿäº†è§£ç¡¬ç›˜çš„ç‰©ç†å‡ ä½•ä»¥æ­£ç¡®å¯»å€.

éšç€ç¡¬ç›˜æŠ€æœ¯è¿›æ­¥,CHSå¯»å€å› å®¹é‡é™åˆ¶ã€æ•ˆç‡é—®é¢˜ã€æŠ€æœ¯å‘å±•ã€å¯»å€ç®€ä¾¿æ€§ã€å…¼å®¹æ€§é—®é¢˜å’Œç‰©ç†ç»“æ„å˜åŒ–è€Œé€æ¸è¢«LBA(Logical Block Addressing)å¯»å€å–ä»£.LBAå°†ä¸‰ç»´å¯»å€è½¬æ¢ä¸ºä¸€ç»´çº¿æ€§å¯»å€,æé«˜äº†ç³»ç»Ÿæ•ˆç‡,é€‚åº”äº†æ›´å¤§å®¹é‡ç¡¬ç›˜çš„éœ€æ±‚.ç°ä»£è®¡ç®—æœºå’Œç¡¬ç›˜æ¥å£å·²ä¸å†ä½¿ç”¨CHSæ¦‚å¿µ,è€Œé‡‡ç”¨LBAå¯»å€.

## è°ƒåº¦ç®—æ³•

> [ç£ç›˜è°ƒåº¦ç®—æ³•FCFSã€SSTFã€SCANã€CSCAN](https://www.cnblogs.com/chen-cs/p/13180242.html)
> 
> [ç£ç›˜è°ƒåº¦ç®—æ³•å‰–æ(FIFOã€SSTFã€SCANã€CSCANã€FSCAN)](https://blog.csdn.net/Jaster_wisdom/article/details/52345674)

NCQ(native command queuing) ç£ç›˜æ§åˆ¶å™¨é‡æ’åº, **æ•°æ®åº“äº¤æ˜“æ—¥å¿—**(å…³é”®æ•°æ®)

> read ahead é¢„è¯»å–+ç¼“å­˜

## æ€§èƒ½è°ƒä¼˜

## å‚è€ƒ

- [å­˜å‚¨å™¨ç³»ç»Ÿ](https://zhuanlan.zhihu.com/p/105388861)
- [ä¸åŒç£é“çš„æ‰‡åŒºæ•°æ˜¯å¦ç›¸åŒ?çš„å›ç­”](https://www.zhihu.com/question/20537787/answer/77591552)
- [ç¡¬ç›˜ç»“æ„(å›¾æ–‡å±•ç¤º)](https://www.cnblogs.com/cyx-b/p/14095057.html)
- [å­˜å‚¨è®¾å¤‡åŸç†:1-Bit ä¿¡æ¯çš„å­˜å‚¨ (ç£ç›˜ã€å…‰ç›˜;é—ªå­˜å’Œ SSD) [å—äº¬å¤§å­¦2023æ“ä½œç³»ç»Ÿ-P25] (è’‹ç‚å²©)](https://www.bilibili.com/video/BV1Bh4y1x7tv/)
- [Cylinder-head-sector](https://en.wikipedia.org/wiki/Cylinder-head-sector)