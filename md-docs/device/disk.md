
# disk

æ¯«ä¸å¤¸å¼ çš„è¯´, ç¡¬ç›˜å ªç§°æœºæ¢°å·¥ç¨‹çš„ä¸€ä¸ªå¥‡è¿¹!

![disks](https://raw.githubusercontent.com/learner-lu/picbed/master/disks.gif)

> ä¸€ä¸ªéå¸¸å¥½çš„ç¡¬ç›˜æœºæ¢°ç»“æ„å¯è§†åŒ–çš„è§†é¢‘: [How do Hard Disk Drives Work?  ğŸ’»ğŸ’¿ğŸ› ](https://www.youtube.com/watch?v=wtdnatmVdIg)

## ç¡¬ç›˜ç»“æ„

![20240415171941](https://raw.githubusercontent.com/learner-lu/picbed/master/20240415171941.png)

ç¡¬ç›˜åŒ…å«å¾ˆå¤šä¸ªç›˜ç‰‡, æ¯ä¸€ä¸ªç›˜ç‰‡æœ‰**ä¸¤é¢**, åœ¨é€»è¾‘ä¸Šè¢«åˆ’åˆ†ä¸ºç£é“ã€æŸ±é¢ä»¥åŠæ‰‡åŒº.

- ç£ç›˜åœ¨æ ¼å¼åŒ–æ—¶è¢«åˆ’åˆ†æˆè®¸å¤š**åŒå¿ƒåœ†**,è¿™äº›åŒå¿ƒåœ†è½¨è¿¹å«åš**ç£é“**(Track),ç£é“ä»å¤–å‘å†…ä»0å¼€å§‹é¡ºåºç¼–å·;
- æ‰€æœ‰ç›˜é¢ä¸Šçš„åŒä¸€ç£é“æ„æˆä¸€ä¸ª**åœ†æŸ±**,é€šå¸¸ç§°åš**æŸ±é¢**(Cylinder),æ¯ä¸ªåœ†æŸ±ä¸Šçš„ç£å¤´ç”±ä¸Šè€Œä¸‹ä»"0"å¼€å§‹ç¼–å·;
- æ¯ä¸ªç£é“ä¼šè¢«åˆ†æˆè®¸å¤šæ®µ**åœ†å¼§**,æ¯æ®µåœ†å¼§å«åšä¸€ä¸ª**æ‰‡åŒº**,æ‰‡åŒºä»"1"å¼€å§‹ç¼–å·,æ¯ä¸ªæ‰‡åŒºä¸­çš„æ•°æ®ä½œä¸ºä¸€ä¸ªå•å…ƒåŒæ—¶è¯»å‡ºæˆ–å†™å…¥,æ“ä½œç³»ç»Ÿä»¥æ‰‡åŒº(Sector)å½¢å¼å°†ä¿¡æ¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Š,æ¯ä¸ªæ‰‡åŒºåŒ…æ‹¬**512**ä¸ªå­—èŠ‚çš„æ•°æ®å’Œä¸€äº›å…¶ä»–ä¿¡æ¯

## å¯»å€

ä¸ºäº†è¯»åˆ°ç¡¬ç›˜çš„æ•°æ®, å®ƒæœ‰ä¸¤ä¸ªè‡ªç”±åº¦

![20240327202619](https://raw.githubusercontent.com/learner-lu/picbed/master/20240327202619.png)

CHS æ˜¯ä¸€ç§**æ—©æœŸ**æ–¹æ³•,ç”¨äºä¸ºç¡¬ç›˜é©±åŠ¨å™¨ä¸Šçš„æ¯ä¸ªç‰©ç†æ•°æ®å—æä¾›åœ°å€.

å®ƒæ˜¯ç”±å‚ç›´åæ ‡å¤´ã€æ°´å¹³(æˆ–å¾„å‘)åæ ‡åœ†æŸ±ä½“å’Œè§’åæ ‡æ‰‡åŒºç»„æˆçš„ 3D åæ ‡ç³».å¤´éƒ¨é€‰æ‹©ä¸€ä¸ªåœ†å½¢è¡¨é¢:åœ†ç›˜ä¸­çš„ç›˜ç‰‡(åŠå…¶ä¸¤ä¾§ä¹‹ä¸€).åœ†æŸ±ä½“æ˜¯åœ†ç›˜ä¸­ç›˜ç‰‡å †å çš„åœ†æŸ±å½¢äº¤å‰ç‚¹,ä»¥åœ†ç›˜çš„ä¸»è½´ä¸ºä¸­å¿ƒ.ç»„åˆèµ·æ¥,åœ†æŸ±ä½“å’Œå¤´éƒ¨ç›¸äº¤åˆ°ä¸€æ¡åœ†å½¢çº¿,æˆ–è€…æ›´å‡†ç¡®åœ°è¯´:ç§°ä¸ºè½¨é“çš„ç‰©ç†æ•°æ®å—çš„åœ†å½¢æ¡å¸¦.æ‰‡åŒºæœ€ç»ˆé€‰æ‹©è¦å¯»å€æ­¤ç£é“ä¸­çš„å“ªä¸ªæ•°æ®å—,å› ä¸ºç£é“è¢«ç»†åˆ†ä¸ºå‡ ä¸ªå¤§å°ç›¸ç­‰çš„éƒ¨åˆ†,æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯ (360/n) åº¦çš„å¼§å½¢,å…¶ä¸­ n æ˜¯ç£é“ä¸­çš„æ‰‡åŒºæ•°.

CHS åœ°å€è¢«å…¬å¼€,è€Œä¸æ˜¯ç®€å•çš„çº¿æ€§åœ°å€(ä» 0 åˆ°ç£ç›˜ä¸Šçš„æ€»å—è®¡æ•° - 1),å› ä¸ºæ—©æœŸçš„ç¡¬ç›˜é©±åŠ¨å™¨æ²¡æœ‰åµŒå…¥å¼ç£ç›˜æ§åˆ¶å™¨,è¿™ä¼šéšè—ç‰©ç†å¸ƒå±€.ä½¿ç”¨å•ç‹¬çš„é€šç”¨æ§åˆ¶å™¨å¡,ä»¥ä¾¿æ“ä½œç³»ç»Ÿå¿…é¡»çŸ¥é“è¿æ¥åˆ°æ§åˆ¶å™¨çš„ç‰¹å®šé©±åŠ¨å™¨çš„ç¡®åˆ‡ç‰©ç†"å‡ ä½•å½¢çŠ¶",ä»¥æ­£ç¡®å¯»å€æ•°æ®å—.ä¼ ç»Ÿçš„é™åˆ¶æ˜¯ 512 å­—èŠ‚/æ‰‡åŒºÃ— 63 ä¸ªæ‰‡åŒº/ç£é“Ã— 255 ç£å¤´(ç£é“/æŸ±é¢)Ã— 1024 ä¸ªæŸ±é¢,å› æ­¤ç£ç›˜çš„æ€»å®¹é‡é™åˆ¶ä¸º 8032.5 MiB.

éšç€å‡ ä½•å½¢çŠ¶å˜å¾—è¶Šæ¥è¶Šå¤æ‚(ä¾‹å¦‚,éšç€åŒºåŸŸä½è®°å½•çš„å¼•å…¥)å’Œé©±åŠ¨å™¨å¤§å°éšç€æ—¶é—´çš„æ¨ç§»è€Œå¢é•¿,CHS å¯»å€æ–¹æ³•å˜å¾—å…·æœ‰é™åˆ¶æ€§.è‡ª 1980 å¹´ä»£åæœŸä»¥æ¥,ç¡¬ç›˜é©±åŠ¨å™¨å¼€å§‹é…å¤‡åµŒå…¥å¼ç£ç›˜æ§åˆ¶å™¨ [1] ,è¯¥æ§åˆ¶å™¨å¯¹ç‰©ç†å‡ ä½•å½¢çŠ¶æœ‰å¾ˆå¥½çš„äº†è§£;ç„¶è€Œ,ä»–ä»¬ä¼šå‘è®¡ç®—æœºæŠ¥å‘Šé”™è¯¯çš„å‡ ä½•å½¢çŠ¶,ä¾‹å¦‚,ç£å¤´æ•°é‡å¤§äºå®é™…å­˜åœ¨çš„æ•°é‡,ä»¥è·å¾—æ›´å¤šçš„å¯å¯»å€ç©ºé—´.è¿™äº›é€»è¾‘ CHS å€¼å°†ç”±æ§åˆ¶å™¨è½¬æ¢,å› æ­¤ CHS å¯»å€ä¸å†å¯¹åº”äºé©±åŠ¨å™¨çš„ä»»ä½•ç‰©ç†å±æ€§. [2]

åˆ° 1990 å¹´ä»£ä¸­æœŸ,ç¡¬ç›˜é©±åŠ¨å™¨æ¥å£ç”¨é€»è¾‘å—å¯»å€ (LBA) å–ä»£äº† CHS æ–¹æ¡ˆ,ä½†è®¸å¤šç”¨äºæ“ä½œä¸»å¼•å¯¼è®°å½• (MBR) åˆ†åŒºè¡¨çš„å·¥å…·ä»ç„¶å°†åˆ†åŒºä¸æŸ±é¢è¾¹ç•Œå¯¹é½;å› æ­¤,åˆ° 2000 å¹´ä»£åæœŸ,åœ¨åˆ†åŒºè½¯ä»¶ä¸­ä»ç„¶å¯ä»¥çœ‹åˆ° CHS å¯»å€çš„ä¼ªå½±.

åœ¨ 2010 å¹´ä»£åˆæœŸ,MBR æ–½åŠ çš„ç£ç›˜å¤§å°é™åˆ¶æˆä¸ºé—®é¢˜,GUID åˆ†åŒºè¡¨ (GPT) è¢«è®¾è®¡ä¸ºæ›¿ä»£å“;ä½¿ç”¨ä¸æ”¯æŒ MBR çš„ UEFI å›ºä»¶çš„ç°ä»£è®¡ç®—æœº**ä¸å†ä½¿ç”¨ CHS** å¯»å€ä¸­çš„ä»»ä½•æ¦‚å¿µ.

ç£ç›˜å¯»å€çš„CHS(Cylinder-Head-Sector)æ–¹å¼è¢«LBA(Logical Block Addressing)æ–¹å¼æ·˜æ±°çš„åŸå› ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹:

1. **å®¹é‡é™åˆ¶**:CHSå¯»å€æ–¹å¼ç”±äºå…¶è®¾è®¡ä¸Šçš„é™åˆ¶,æœ€å¤§å¯»å€èŒƒå›´æœ‰é™.æ ¹æ®CHSå¯»å€æ–¹å¼,ä½¿ç”¨8ä½æ¥å­˜å‚¨ç£å¤´åœ°å€,10ä½æ¥å­˜å‚¨æŸ±é¢åœ°å€,6ä½æ¥å­˜å‚¨æ‰‡åŒºåœ°å€,è€Œä¸€ä¸ªæ‰‡åŒºå…±æœ‰512å­—èŠ‚,è¿™æ ·ä½¿ç”¨CHSå¯»å€ä¸€å—ç¡¬ç›˜æœ€å¤§å®¹é‡ä¸º256 * 1024 * 63 * 512B = 8064MB(1MB = 1048576B),å¦‚æœæŒ‰ç…§1MB=1000000Bæ¥ç®—åˆ™ä¸º8.4GB.

2. **æ•ˆç‡é—®é¢˜**:CHSå¯»å€æ–¹å¼éœ€è¦åˆ†åˆ«å­˜å‚¨æ¯ä¸ªåŒºåŸŸçš„ä¸‰ä¸ªå‚æ•°(ç£å¤´ã€æŸ±é¢å’Œæ‰‡åŒº),ä½¿ç”¨æ—¶å†åˆ†åˆ«è¯»å–è¿™ä¸‰ä¸ªå‚æ•°,ç„¶ååœ¨é€åˆ°ç£ç›˜æ§åˆ¶å™¨å»æ‰§è¡Œ.è¿™ç§æ–¹å¼åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶æ•ˆç‡è¾ƒä½.

3. **æŠ€æœ¯è¿›æ­¥**:éšç€ç¡¬ç›˜æŠ€æœ¯çš„è¿›æ­¥,ç¡¬ç›˜å®¹é‡è¶Šæ¥è¶Šå¤§,CHSæ¨¡å¼æ— æ³•ç®¡ç†è¶…è¿‡8064MBçš„ç¡¬ç›˜.å·¥ç¨‹å¸ˆä»¬å‘æ˜äº†æ›´åŠ ç®€ä¾¿çš„LBAå¯»å€æ–¹å¼æ¥é€‚åº”æ›´å¤§å®¹é‡çš„ç¡¬ç›˜.

4. **å¯»å€ç®€ä¾¿æ€§**:LBAç¼–å€æ–¹å¼å°†CHSè¿™ç§ä¸‰ç»´å¯»å€æ–¹å¼è½¬å˜ä¸ºä¸€ç»´çš„çº¿æ€§å¯»å€,å®ƒæŠŠç¡¬ç›˜æ‰€æœ‰çš„ç‰©ç†æ‰‡åŒºçš„C/H/Sç¼–å·é€šè¿‡ä¸€å®šçš„è§„åˆ™è½¬å˜ä¸ºä¸€çº¿æ€§çš„ç¼–å·,ç³»ç»Ÿæ•ˆç‡å¾—åˆ°å¤§å¤§æé«˜,é¿å…äº†çƒ¦ççš„ç£å¤´/æŸ±é¢/æ‰‡åŒºçš„å¯»å€æ–¹å¼.

5. **å…¼å®¹æ€§é—®é¢˜**:ä¸€äº›å¤è€çš„è½¯ä»¶ä»ç„¶ä½¿ç”¨CHSå¯»å€æ–¹å¼,ä¸ºäº†å…¼å®¹è¿™æ ·çš„ç¨‹åº,åœ¨ç¡¬ç›˜æ§åˆ¶å™¨å†…éƒ¨å®‰è£…äº†ä¸€ä¸ªåœ°å€ç¿»è¯‘å™¨,å¯ä»¥é€šè¿‡å®ƒå°†è€å¼CHSå‚æ•°ç¿»è¯‘æˆæ–°çš„çº¿æ€§å‚æ•°.ä½†éšç€æ—¶é—´çš„æ¨ç§»,æ–°è½¯ä»¶å’Œæ“ä½œç³»ç»Ÿæ™®éé‡‡ç”¨LBAå¯»å€æ–¹å¼,ä½¿å¾—CHSå¯»å€æ–¹å¼çš„ä½¿ç”¨é€æ¸å‡å°‘.

6. **ç‰©ç†ç»“æ„å˜åŒ–**:ç¡¬ç›˜çš„ç‰©ç†ç»“æ„ä¹Ÿåœ¨å˜åŒ–,ç°ä»£ç¡¬ç›˜é‡‡ç”¨ç­‰å¯†åº¦ç»“æ„ç”Ÿäº§,å¤–åœˆç£é“çš„æ‰‡åŒºæ¯”å†…åœˆç£é“å¤š,è¿™ç§ç»“æ„ä¸‹ç¡¬ç›˜ä¸å†å…·æœ‰å®é™…çš„CHSå‚æ•°,å¯»å€æ–¹å¼ä¹Ÿæ”¹ä¸ºçº¿æ€§å¯»å€,å³ä»¥æ‰‡åŒºä¸ºå•ä½è¿›è¡Œå¯»å€.

åŸºäºä»¥ä¸ŠåŸå› ,CHSå¯»å€æ–¹å¼é€æ¸è¢«LBAå¯»å€æ–¹å¼æ‰€å–ä»£,LBAå¯»å€æ–¹å¼æä¾›äº†æ›´å¤§çš„å¯»å€ç©ºé—´å’Œæ›´é«˜çš„å¯»å€æ•ˆç‡,æ›´å¥½åœ°é€‚åº”äº†ç°ä»£ç¡¬ç›˜æŠ€æœ¯çš„å‘å±•.

ç”µæ¢¯ç®—æ³•

> [ç£ç›˜è°ƒåº¦ç®—æ³•FCFSã€SSTFã€SCANã€CSCAN](https://www.cnblogs.com/chen-cs/p/13180242.html)
> 
> [ç£ç›˜è°ƒåº¦ç®—æ³•å‰–æ(FIFOã€SSTFã€SCANã€CSCANã€FSCAN)](https://blog.csdn.net/Jaster_wisdom/article/details/52345674)

NCQ(native command queuing) ç£ç›˜æ§åˆ¶å™¨é‡æ’åº, **æ•°æ®åº“äº¤æ˜“æ—¥å¿—**(å…³é”®æ•°æ®)

> read ahead è¯»æ•°æ®+ç¼“å­˜

## æ€§èƒ½è°ƒä¼˜

## å‚è€ƒ

- [å­˜å‚¨å™¨ç³»ç»Ÿ](https://zhuanlan.zhihu.com/p/105388861)
- [ä¸åŒç£é“çš„æ‰‡åŒºæ•°æ˜¯å¦ç›¸åŒ?çš„å›ç­”](https://www.zhihu.com/question/20537787/answer/77591552)
- [ç¡¬ç›˜ç»“æ„(å›¾æ–‡å±•ç¤º)](https://www.cnblogs.com/cyx-b/p/14095057.html)
- [å­˜å‚¨è®¾å¤‡åŸç†:1-Bit ä¿¡æ¯çš„å­˜å‚¨ (ç£ç›˜ã€å…‰ç›˜;é—ªå­˜å’Œ SSD) [å—äº¬å¤§å­¦2023æ“ä½œç³»ç»Ÿ-P25] (è’‹ç‚å²©)](https://www.bilibili.com/video/BV1Bh4y1x7tv/)
- [Cylinder-head-sector](https://en.wikipedia.org/wiki/Cylinder-head-sector)