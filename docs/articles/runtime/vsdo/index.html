<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Document
    </title>
    <link rel='stylesheet' href=../../../css/index.css />
    <link rel='stylesheet' href=../../../css/c.css /><link rel='stylesheet' href=../../../css/diff.css /><link rel='stylesheet' href=../../../css/json.css /><link rel='stylesheet' href=../../../css/makefile.css /><link rel='stylesheet' href=../../../css/shell.css /><link rel='stylesheet' href=../../../css/txt.css />
    <link rel="icon" href="https://raw.githubusercontent.com/learner-lu/picbed/master/logo.png">
</head>

<body class="light">
    <a href="https://github.com/luzhixing12345/klinux" target="_blank" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <div class="header-navigator"><ul><li><a href="#h1-0">vsdo</a><ul><li><a href="#h2-1">vsyscall</a></li></ul><ul><li><a href="#h2-2">VDSO</a><ul><li><a href="#h3-3">快慢系统调用</a></li></ul><ul><li><a href="#h3-4">实现细节</a></li></ul><ul><li><a href="#h3-5">调用原理示例</a></li></ul><ul><li><a href="#h3-6">VDSO 的构建</a></li></ul><ul><li><a href="#h3-7">libc 调用 vsdo</a></li></ul></li></ul><ul><li><a href="#h2-8">vvar</a></li></ul><ul><li><a href="#h2-9">性能测试</a></li></ul><ul><li><a href="#h2-10">参考</a><ul><li><a href="#h3-11">VSDO</a></li></ul><ul><li><a href="#h3-12">ASLR</a></li></ul></li></ul></li></ul></div><div class='markdown-body'><h1 id="h1-0">vsdo</h1><p>系统调用(system call) 是 Linux 内核中的特殊例程, 用户空间应用程序要求执行特权任务, 例如读取或写入文件/打开套接字等. 我们知道在 Linux 内核中调用系统调用是一项代价高昂的操作, 因为处理器必须中断当前正在执行的任务并将上下文切换到内核模式,然后在系统调用处理程序完成其工作后再次跳转到用户空间.</p><p>但是我们注意到, 对于系统调用 gettimeofday, 实际上并不涉及任何数据安全问题,因为特权用户root和非特权用户都会获得相同的结果.这就意味着其实完全可以通过新的实现机制来避免执行系统调用的开销,因为本质上gettimeofday()就是从内核中读取与时间相关的数据(虽然会有一些复杂的计算过程).与其费尽心力一定要通过陷入内核的方式来读取这些数据,不如在内核与用户态之间建立一段共享内存区域,由内核定期&quot;推送&quot;最新值到该共享内存区域,然后用户态程序在调用这些系统调用的glibc库函数的时候,<b>库函数并不真正执行系统调用,而是通过vsyscall page来读取该数据的最新值,相当于将系统调用改造成了函数调用,直接提升了执行性能</b></p><p>因此为了加速某些系统调用, 我们来介绍一下 <code>vsyscall</code> 和 <code>vDSO</code></p><h2 id="h2-1">vsyscall</h2><p>vsyscall or virtual system call 是 Linux 内核中第一个也是最古老的机制, 也是一个<b>过时的概念</b>, 这里简单介绍了解一下</p><p>vsyscall 背后的想法很简单.某些系统调用只是将数据返回到用户空间.如果内核将这些系统调用实现和相关数据映射到用户空间页面, 应用程序就可以像简单的函数调用一样触发这些系统调用.用户空间和内核空间之间不会有上下文切换</p><blockquote><p>在 Linux 内核文档中找到有关此内存空间的信息x86_64 <a href="https://github.com/torvalds/linux/blob/16f73eb02d7e1765ccab3d2018e0bd98eb93d973/Documentation/x86/x86_64/mm.txt#L23" target="_blank">linux mm.txt#L23</a></p><pre class="language-txt"><code><span class="Token ID">ffffffffff600000</span><span class="Token SPACE"> </span><span class="Token MINUS">-</span><span class="Token SPACE"> </span><span class="Token ID">ffffffffffdfffff</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ASSIGN">=</span><span class="Token NUMBER">8</span><span class="Token SPACE"> </span><span class="Token ID">MB</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token ID">vsyscalls</span></code></pre></blockquote><p>call chain:</p><pre class="language-shell"><code><span class="Token Program ID">start_kernel</span><span class="Token SPACE">        </span><span class="Token COMMENT"># init/main.c</span><span class="Token LF">
</span><span class="Token Program ID">setup_arch</span><span class="Token SPACE">          </span><span class="Token COMMENT"># arch/x86/kernel/setup.c</span><span class="Token LF">
</span><span class="Token Program ID">map_vsyscall</span><span class="Token SPACE">        </span><span class="Token COMMENT"># arch/x86/entry/vsyscall/vsyscall_64.c</span></code></pre><pre class="language-c"><code><span class="Token Keyword BaseType TypeSpecifier FunctionReturnType VOID">void</span><span class="Token Keyword BaseType TypeSpecifier FunctionReturnType SPACE"> </span><span class="Token MacroDefine Keyword Typedefine TypeSpecifier FunctionReturnType TYPEDEF_ID">__init</span><span class="Token Keyword Typedefine TypeSpecifier FunctionReturnType SPACE"> </span><span class="Token Identifier DirectDeclaractor FunctionName FunctionName ID">map_vsyscall</span><span class="Token DirectDeclaractor Declarator BraceDepth-0 LPAREN">(</span><span class="Token Keyword BaseType TypeSpecifier VOID">void</span><span class="Token DirectDeclaractor Declarator BraceDepth-0 RPAREN">)</span><span class="Token DirectDeclaractor Declarator LF">
</span><span class="Token CompoundStatement Function BraceDepth-0 LCURLY_BRACE">{</span><span class="Token CompoundStatement Function LF">
</span><span class="Token CompoundStatement Function SPACE">    </span><span class="Token CompoundStatement Function COMMENT">// 获取 vsyscall 页面的物理地址, .S 中定义的 __vsyscall_page 地址</span><span class="Token CompoundStatement Function LF">
</span><span class="Token CompoundStatement Function SPACE">    </span><span class="Token Keyword StorageType EXTERN">extern</span><span class="Token Keyword StorageType SPACE"> </span><span class="Token Keyword BaseType TypeSpecifier CHAR">char</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Identifier DirectDeclaractor ID">__vsyscall_page</span><span class="Token Declaration SEMI">;</span><span class="Token Declaration LF">
</span><span class="Token Declaration SPACE">    </span><span class="Token Keyword BaseType TypeSpecifier UNSIGNED">unsigned</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Keyword BaseType TypeSpecifier LONG">long</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Identifier DirectDeclaractor ID">physaddr_vsyscall</span><span class="Token Identifier DirectDeclaractor SPACE"> </span><span class="Token InitDeclarator ASSIGN">=</span><span class="Token InitDeclarator SPACE"> </span><span class="Token Identifier PrimaryExpression FunctionCall ID">__pa_symbol</span><span class="Token PostfixExpression UnaryExpression BraceDepth-1 LPAREN">(</span><span class="Token UnaryOp UnaryExpression AMPERSAND">&amp;</span><span class="Token Identifier PrimaryExpression ID">__vsyscall_page</span><span class="Token PostfixExpression UnaryExpression BraceDepth-1 RPAREN">)</span><span class="Token Declaration SEMI">;</span><span class="Token Declaration LF">
</span><span class="Token Declaration LF">
</span><span class="Token Declaration SPACE">    </span><span class="Token Keyword SelectionStatement IF">if</span><span class="Token Keyword SelectionStatement SPACE"> </span><span class="Token SelectionStatement BraceDepth-1 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">vsyscall_mode</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token BinaryOp ConditionalExpression EQ">==</span><span class="Token BinaryOp ConditionalExpression SPACE"> </span><span class="Token Identifier MacroDefine PrimaryExpression ID">EMULATE</span><span class="Token SelectionStatement BraceDepth-1 RPAREN">)</span><span class="Token SelectionStatement SPACE"> </span><span class="Token CompoundStatement SelectionStatement BraceDepth-1 LCURLY_BRACE">{</span><span class="Token CompoundStatement SelectionStatement LF">
</span><span class="Token CompoundStatement SelectionStatement SPACE">        </span><span class="Token Identifier PrimaryExpression FunctionCall ID">__set_fixmap</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 LPAREN">(</span><span class="Token Identifier MacroDefine PrimaryExpression ID">VSYSCALL_PAGE</span><span class="Token PostfixExpression UnaryExpression COMMA">,</span><span class="Token PostfixExpression UnaryExpression SPACE"> </span><span class="Token Identifier PrimaryExpression ID">physaddr_vsyscall</span><span class="Token PostfixExpression UnaryExpression COMMA">,</span><span class="Token PostfixExpression UnaryExpression LF">
</span><span class="Token PostfixExpression UnaryExpression SPACE">                 </span><span class="Token Identifier MacroDefine PrimaryExpression ID">PAGE_KERNEL_VVAR</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 RPAREN">)</span><span class="Token ExpressionStatement SEMI">;</span><span class="Token ExpressionStatement LF">
</span><span class="Token ExpressionStatement SPACE">        </span><span class="Token Identifier PrimaryExpression FunctionCall ID">set_vsyscall_pgtable_user_bits</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">swapper_pg_dir</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 RPAREN">)</span><span class="Token ExpressionStatement SEMI">;</span><span class="Token ExpressionStatement LF">
</span><span class="Token ExpressionStatement SPACE">    </span><span class="Token CompoundStatement SelectionStatement BraceDepth-1 RCURLY_BRACE">}</span><span class="Token CompoundStatement SelectionStatement LF">
</span><span class="Token CompoundStatement SelectionStatement LF">
</span><span class="Token CompoundStatement SelectionStatement SPACE">    </span><span class="Token CompoundStatement SelectionStatement COMMENT">// config 默认是走 XONLY 这个分支</span><span class="Token CompoundStatement SelectionStatement LF">
</span><span class="Token CompoundStatement SelectionStatement SPACE">    </span><span class="Token Keyword SelectionStatement IF">if</span><span class="Token Keyword SelectionStatement SPACE"> </span><span class="Token SelectionStatement BraceDepth-1 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">vsyscall_mode</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token BinaryOp ConditionalExpression EQ">==</span><span class="Token BinaryOp ConditionalExpression SPACE"> </span><span class="Token Identifier MacroDefine PrimaryExpression ID">XONLY</span><span class="Token SelectionStatement BraceDepth-1 RPAREN">)</span><span class="Token SelectionStatement LF">
</span><span class="Token SelectionStatement SPACE">        </span><span class="Token Identifier PrimaryExpression FunctionCall ID">vm_flags_init</span><span class="Token PostfixExpression UnaryExpression BraceDepth-1 LPAREN">(</span><span class="Token UnaryOp UnaryExpression AMPERSAND">&amp;</span><span class="Token Identifier PrimaryExpression ID">gate_vma</span><span class="Token PostfixExpression UnaryExpression COMMA">,</span><span class="Token PostfixExpression UnaryExpression SPACE"> </span><span class="Token Identifier MacroDefine PrimaryExpression ID">VM_EXEC</span><span class="Token PostfixExpression UnaryExpression BraceDepth-1 RPAREN">)</span><span class="Token ExpressionStatement SelectionStatement SEMI">;</span><span class="Token ExpressionStatement SelectionStatement LF">
</span><span class="Token ExpressionStatement SelectionStatement LF">
</span><span class="Token ExpressionStatement SelectionStatement SPACE">    </span><span class="Token Identifier MacroDefine PrimaryExpression ID">BUILD_BUG_ON</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token PPtoken BraceDepth-2 LPAREN">(</span><span class="Token Keyword UNSIGNED">unsigned</span><span class="Token Keyword SPACE"> </span><span class="Token Keyword LONG">long</span><span class="Token PPtoken BraceDepth-2 RPAREN">)</span><span class="Token MacroDefine Identifier ID">__fix_to_virt</span><span class="Token PPtoken BraceDepth-2 LPAREN">(</span><span class="Token Identifier MacroDefine ID">VSYSCALL_PAGE</span><span class="Token PPtoken BraceDepth-2 RPAREN">)</span><span class="Token PPtoken SPACE"> </span><span class="Token PPtoken NE">!=</span><span class="Token PPtoken LF">
</span><span class="Token PPtoken SPACE">             </span><span class="Token PPtoken BraceDepth-2 LPAREN">(</span><span class="Token Keyword UNSIGNED">unsigned</span><span class="Token Keyword SPACE"> </span><span class="Token Keyword LONG">long</span><span class="Token PPtoken BraceDepth-2 RPAREN">)</span><span class="Token Identifier MacroDefine ID">VSYSCALL_ADDR</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token ExpressionStatement SEMI">;</span><span class="Token ExpressionStatement LF">
</span><span class="Token CompoundStatement Function BraceDepth-0 RCURLY_BRACE">}</span></code></pre><p>初始化的过程位于函数 <code>vsyscall_setup</code>, 其将在早期内核参数解析期间调用, 有关 early_param 宏的更多信息见 &quot;内核初始化&quot; 部分</p><pre class="language-c"><code><span class="Token Identifier PrimaryExpression FunctionCall ID">early_param</span><span class="Token PostfixExpression UnaryExpression BraceDepth-0 LPAREN">(</span><span class="Token String STRING">&quot;vsyscall&quot;</span><span class="Token PostfixExpression UnaryExpression COMMA">,</span><span class="Token PostfixExpression UnaryExpression SPACE"> </span><span class="Token Identifier PrimaryExpression ID">vsyscall_setup</span><span class="Token PostfixExpression UnaryExpression BraceDepth-0 RPAREN">)</span><span class="Token ExpressionStatement SEMI">;</span></code></pre><p>由于所有的进程都共享内核映射,因此所有的进程也自然而言能够访问到vsyscall page, <code>__kernel_vsyscall</code> 是一个特殊的页,其位于内核地址空间,但也是唯一允许用户访问的区域</p><p><a href="https://github.com/torvalds/linux/blob/16f73eb02d7e1765ccab3d2018e0bd98eb93d973/arch/x86/entry/vsyscall/vsyscall_emu_64.S" target="_blank">arch/x86/entry/vsyscall/vsyscall_emu_64.S</a> 可以看到包含以下三个系统调用的调用 gettimeofday time getcpu</p><p>但是后来开发人员又抛弃了vsyscall机制, 原因有两点:</p><ol start="1"><li>映射地址在每个进程中都是<b>固定的</b>.固定地址被认为违反了 ASLR (地址空间布局随机化), 这使得攻击更容易写入漏洞, 因此很容易成为ret2libc攻击的跳板.</li></ol><ol start="2"><li>vsyscall能支持的系统调用数有限,无法很方便地进行扩展</li></ol><blockquote><p>MIT-6.S081 的 lab3 的第一个实验就是加速系统调用</p></blockquote><h2 id="h2-2">VDSO</h2><p><code>vDSO</code> 是 <code>virtual dynamic shared object</code> 的缩写,表示这段mapping实际包含的是一个ELF共享目标文件,也就是俗称的.so</p><p>通常来说,大多数情况下我们不需要关系有关vDSO的实现细节,因为只有对它的调用是由C库完成的,所以vDSO对大多数人来说都是透明的. 如果尝试在自己的应用程序中调用 vDSO,而不是使用 C 库,则很可能做错了</p><p>源码位于: arch/x86/entry/vdso/</p><h3 id="h3-3">快慢系统调用</h3><p>在x86-32系统大行其道的时代,调用系统调用的方法就是 <code>int $0x80</code>.这种方法的执行速度非常慢,原因是它<b>需要经历一个完整的中断处理过程</b>,这包括Linux内核以及与中断流程相关的处理器微码的执行开销.</p><p>后来为了提升系统调用的性能,Intel最先实现了专门的快速系统调用指令 <code>sysenter</code> 和系统调用返回指令 <code>sysexit</code> ;后来AMD针锋相对地实现了另一组专门的快速系统调用指令 <code>syscall</code> 和系统调用返回指令 <code>sysret</code>.</p><p>快速系统调用的&quot;快&quot;字,体现在以下几个方面:</p><ul><li>处理器在切换到内核态后不再自动往内核栈中自动保存任何上下文信息了,这样避免了访内开销.</li></ul><ul><li>处理器也不再自动加载内核栈的值到rsp寄存器了,节省了指令开销.</li></ul><ul><li>syscall和sysret指令只能用在平坦内存模型中,因此在执行快速系统调用时bypass了MMU的分段单元的检查,节省了微码的执行开销.</li></ul><ul><li>处理器微码不再需要走中断处理和中断恢复流程,大幅度提高了执行性能.</li></ul><p>与Intel的快速系统调用指令相比,AMD的syscall/sysret要更快更灵活:</p><ul><li>执行syscall和sysret指令时,不再需要处理器自动保存和恢复用户栈指针了,因此也不需要再事先设置MSR来指定要恢复和保存的用户栈指针了.</li></ul><ul><li>通过系统调用进入内核态后,rflags寄存器中哪些位应该清0原本是固定的,但是如果是用syscall来执行系统调用的话,那这些位是可以通过编程来事先设置的.</li></ul><p>最后,Intel也提供了对sysenter/sysexit指令的支持.之后,为了获得最好的兼容性(Intel和AMD通用),x86-64 <b>Linux内核将快速系统调用的支持方式统一到了syscall/sysret.</b></p><h3 id="h3-4">实现细节</h3><p>我们可以使用 ldd 来查看一个可执行文件的动态链接库依赖</p><pre class="language-shell"><code><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token Program ID">base</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token HOST_NAME">kamilu@LZX</span><span class="Token COLON">:</span><span class="Token DIR_PATH">~</span><span class="Token TAG">$</span><span class="Token SPACE"> </span><span class="Token Program ID">ldd</span><span class="Token SPACE"> </span><span class="Token BACKTICK">`</span><span class="Token ID">which</span><span class="Token SPACE"> </span><span class="Token ID">bash</span><span class="Token BACKTICK">`</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token Function Program ID">linux-vdso.so.1</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token NUMBER">0x00007fffd2bec000</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token Variant Program ID">libtinfo.so.6</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token REDIRECT_TO">&gt;</span><span class="Token SPACE"> </span><span class="Token Function ID">/lib/x86_64-linux-gnu/libtinfo.so.6</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token NUMBER">0x00007f31064cc000</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token Variant Program ID">libc.so.6</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token REDIRECT_TO">&gt;</span><span class="Token SPACE"> </span><span class="Token Function ID">/lib/x86_64-linux-gnu/libc.so.6</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token NUMBER">0x00007f31062a4000</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token Function Program ID">/lib64/ld-linux-x86-64.so.2</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token NUMBER">0x00007f3106678000</span><span class="Token BraceDepth-0 RPAREN">)</span></code></pre><blockquote><p>多次执行可以发现每一次的 .so 地址都不固定, 这就是利用 ASLR 防止攻击者可靠地跳转到内存中被利用的特定函数,ASLR 会随机排列进程关键数据区域的地址空间位置,包括可执行文件的基础以及堆栈/堆和库的位置</p></blockquote><p>当内核加载一个ELF可执行程序时,内核都会在其进程地址空间中建立一个叫做vDSO mapping的内存区域.</p><p>vDSO与vsyscall最大的不同体现在以下方面:</p><ul><li>vDSO本质上是一个<b>ELF共享目标文件</b>;而vsyscall只是<b>一段内存代码和数据</b>, 映射到一个固定的地址区间.</li></ul><ul><li>vsyscall位于内核地址空间,采用<b>静态地址映射方式</b>; 而vDSO借助共享目标文件天生具有的PIC特性,可以<b>以进程为粒度动态映射到进程地址空间</b>中</li></ul><h3 id="h3-5">调用原理示例</h3><p>我们以 <code>getcpu</code> 这个系统调用为例, 看一下 vdso 如何实现用户态调用</p><p>getcpu 系统调用被声明为 <code>__vdso_getcpu</code> 的一个弱符号, 相当于做了一个函数换名, 内部转而调用 <code>vdso_read_cpunode</code></p><pre class="language-c"><code><span class="Token COMMENT">// arch/x86/entry/vdso/vgetcpu.c</span><span class="Token LF">
</span><span class="Token Keyword BaseType TypeSpecifier FunctionReturnType LONG">long</span><span class="Token Keyword BaseType TypeSpecifier FunctionReturnType SPACE"> </span><span class="Token Identifier DirectDeclaractor FunctionName FunctionName ID">__vdso_getcpu</span><span class="Token DirectDeclaractor Declarator BraceDepth-0 LPAREN">(</span><span class="Token Keyword BaseType TypeSpecifier UNSIGNED">unsigned</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token Identifier DirectDeclaractor ID">cpu</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token Keyword BaseType TypeSpecifier UNSIGNED">unsigned</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token Identifier DirectDeclaractor ID">node</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token Keyword StructureType Structure TypeSpecifier STRUCT">struct</span><span class="Token Keyword StructureType Structure TypeSpecifier SPACE"> </span><span class="Token Identifier Structure StructureClass TypeSpecifier ID">getcpu_cache</span><span class="Token Identifier Structure StructureClass TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token Identifier DirectDeclaractor ID">unused</span><span class="Token DirectDeclaractor Declarator BraceDepth-0 RPAREN">)</span><span class="Token DirectDeclaractor Declarator LF">
</span><span class="Token CompoundStatement Function BraceDepth-0 LCURLY_BRACE">{</span><span class="Token CompoundStatement Function LF">
</span><span class="Token CompoundStatement Function SPACE">    </span><span class="Token Identifier PrimaryExpression FunctionCall ID">vdso_read_cpunode</span><span class="Token PostfixExpression UnaryExpression BraceDepth-1 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">cpu</span><span class="Token PostfixExpression UnaryExpression COMMA">,</span><span class="Token PostfixExpression UnaryExpression SPACE"> </span><span class="Token Identifier PrimaryExpression ID">node</span><span class="Token PostfixExpression UnaryExpression BraceDepth-1 RPAREN">)</span><span class="Token ExpressionStatement SEMI">;</span><span class="Token ExpressionStatement LF">
</span><span class="Token ExpressionStatement LF">
</span><span class="Token ExpressionStatement SPACE">    </span><span class="Token Keyword JumpStatement RETURN">return</span><span class="Token Keyword JumpStatement SPACE"> </span><span class="Token Constant PrimaryExpression NUMBER">0</span><span class="Token JumpStatement SEMI">;</span><span class="Token JumpStatement LF">
</span><span class="Token CompoundStatement Function BraceDepth-0 RCURLY_BRACE">}</span><span class="Token CompoundStatement Function LF">
</span><span class="Token CompoundStatement Function LF">
</span><span class="Token Keyword BaseType TypeSpecifier FunctionReturnType LONG">long</span><span class="Token Keyword BaseType TypeSpecifier FunctionReturnType SPACE"> </span><span class="Token Identifier DirectDeclaractor FunctionName ID">getcpu</span><span class="Token DirectDeclaractor Declarator BraceDepth-0 LPAREN">(</span><span class="Token Keyword BaseType TypeSpecifier UNSIGNED">unsigned</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token Identifier DirectDeclaractor ID">cpu</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token Keyword BaseType TypeSpecifier UNSIGNED">unsigned</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token Identifier DirectDeclaractor ID">node</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token Keyword StructureType Structure TypeSpecifier STRUCT">struct</span><span class="Token Keyword StructureType Structure TypeSpecifier SPACE"> </span><span class="Token Identifier Structure StructureClass TypeSpecifier ID">getcpu_cache</span><span class="Token Identifier Structure StructureClass TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token Identifier DirectDeclaractor ID">tcache</span><span class="Token DirectDeclaractor Declarator BraceDepth-0 RPAREN">)</span><span class="Token DirectDeclaractor Declarator LF">
</span><span class="Token DirectDeclaractor Declarator SPACE">    </span><span class="Token GNU_C_Assembly DirectDeclaractor _ATTRIBUTE">__attribute__</span><span class="Token GNU_C_Assembly DirectDeclaractor BraceDepth-0 LPAREN">(</span><span class="Token PrimaryExpression PostfixExpression BraceDepth-1 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">weak</span><span class="Token Expression PrimaryExpression COMMA">,</span><span class="Token Expression PrimaryExpression SPACE"> </span><span class="Token Identifier PrimaryExpression FunctionCall ID">alias</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 LPAREN">(</span><span class="Token String STRING">&quot;__vdso_getcpu&quot;</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 RPAREN">)</span><span class="Token PrimaryExpression PostfixExpression BraceDepth-1 RPAREN">)</span><span class="Token GNU_C_Assembly DirectDeclaractor BraceDepth-0 RPAREN">)</span><span class="Token Declaration SEMI">;</span></code></pre><p>而 vdso_read_cpunode 内部则使用汇编从 GDT 中读取对应的 cpu 和 NUMA 节点, 整个过程没有陷入内核态</p><pre class="language-c"><code><span class="Token COMMENT">// arch/x86/include/asm/segment.h</span><span class="Token LF">
</span><span class="Token HASH">#</span><span class="Token Keyword Preprocess ControlLine DEFINE">define</span><span class="Token Keyword Preprocess ControlLine SPACE"> </span><span class="Token Identifier ControlLine MarcroFunction ID">alternative_io</span><span class="Token ControlLine BraceDepth-0 LPAREN">(</span><span class="Token Identifier ID">oldinstr</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token Identifier ID">newinstr</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token Identifier ID">ft_flags</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token Identifier ID">output</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token Identifier ID">input</span><span class="Token Keyword ControlLine VARARGS">...</span><span class="Token ControlLine BraceDepth-0 RPAREN">)</span><span class="Token ControlLine SPACE"> </span><span class="Token PPtoken BACK_SLASH">\</span><span class="Token PPtoken LF">
</span><span class="Token PPtoken SPACE">    </span><span class="Token Identifier ID">asm_inline</span><span class="Token Identifier SPACE"> </span><span class="Token Keyword VOLATILE">volatile</span><span class="Token PPtoken BraceDepth-0 LPAREN">(</span><span class="Token Identifier MacroDefine ID">ALTERNATIVE</span><span class="Token PPtoken BraceDepth-1 LPAREN">(</span><span class="Token Identifier ID">oldinstr</span><span class="Token PPtoken COMMA">,</span><span class="Token PPtoken SPACE"> </span><span class="Token Identifier ID">newinstr</span><span class="Token PPtoken COMMA">,</span><span class="Token PPtoken SPACE"> </span><span class="Token Identifier ID">ft_flags</span><span class="Token PPtoken BraceDepth-1 RPAREN">)</span><span class="Token PPtoken SPACE">  </span><span class="Token PPtoken BACK_SLASH">\</span><span class="Token PPtoken LF">
</span><span class="Token PPtoken SPACE">                </span><span class="Token PPtoken COLON">:</span><span class="Token PPtoken SPACE"> </span><span class="Token Identifier ID">output</span><span class="Token Identifier SPACE">                                   </span><span class="Token PPtoken BACK_SLASH">\</span><span class="Token PPtoken LF">
</span><span class="Token PPtoken SPACE">                </span><span class="Token PPtoken COLON">:</span><span class="Token PPtoken SPACE"> </span><span class="Token String STRING">&quot;i&quot;</span><span class="Token PPtoken BraceDepth-1 LPAREN">(</span><span class="Token PPtoken NUMBER">0</span><span class="Token PPtoken BraceDepth-1 RPAREN">)</span><span class="Token PPtoken COMMA">,</span><span class="Token PPtoken SPACE"> </span><span class="Token PPtoken DOUBLE_HASH">##</span><span class="Token Identifier ID">input</span><span class="Token PPtoken BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token Keyword StorageType FunctionReturnType STATIC">static</span><span class="Token Keyword StorageType FunctionReturnType SPACE"> </span><span class="Token Keyword FunctionType FunctionReturnType INLINE">inline</span><span class="Token Keyword FunctionType FunctionReturnType SPACE"> </span><span class="Token Keyword BaseType TypeSpecifier FunctionReturnType VOID">void</span><span class="Token Keyword BaseType TypeSpecifier FunctionReturnType SPACE"> </span><span class="Token Identifier DirectDeclaractor FunctionName FunctionName ID">vdso_read_cpunode</span><span class="Token DirectDeclaractor Declarator BraceDepth-0 LPAREN">(</span><span class="Token Keyword BaseType TypeSpecifier UNSIGNED">unsigned</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token Identifier DirectDeclaractor ID">cpu</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token Keyword BaseType TypeSpecifier UNSIGNED">unsigned</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token Identifier DirectDeclaractor ID">node</span><span class="Token DirectDeclaractor Declarator BraceDepth-0 RPAREN">)</span><span class="Token DirectDeclaractor Declarator LF">
</span><span class="Token CompoundStatement Function BraceDepth-0 LCURLY_BRACE">{</span><span class="Token CompoundStatement Function LF">
</span><span class="Token CompoundStatement Function SPACE">    </span><span class="Token Keyword BaseType TypeSpecifier UNSIGNED">unsigned</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Keyword BaseType TypeSpecifier INT">int</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Identifier DirectDeclaractor ID">p</span><span class="Token Declaration SEMI">;</span><span class="Token Declaration LF">
</span><span class="Token Declaration LF">
</span><span class="Token Declaration SPACE">    </span><span class="Token Declaration COMMENT">/*
     * Load CPU and node number from the GDT.  LSL is faster than RDTSCP
     * and works on all CPUs.  This is volatile so that it orders
     * correctly with respect to barrier() and to keep GCC from cleverly
     * hoisting it out of the calling function.
     *
     * If RDPID is available, use it.
     */</span><span class="Token Declaration LF">
</span><span class="Token Declaration SPACE">    </span><span class="Token Identifier MarcroFunction PrimaryExpression ID">alternative_io</span><span class="Token Identifier MarcroFunction PrimaryExpression SPACE"> </span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token String STRING">&quot;lsl %[seg],%[p]&quot;</span><span class="Token PPtoken COMMA">,</span><span class="Token PPtoken LF">
</span><span class="Token PPtoken SPACE">            </span><span class="Token String STRING">&quot;.byte 0xf3,0x0f,0xc7,0xf8&quot;</span><span class="Token PPtoken COMMA">,</span><span class="Token PPtoken SPACE"> </span><span class="Token PPtoken COMMENT">/* RDPID %eax/rax */</span><span class="Token PPtoken LF">
</span><span class="Token PPtoken SPACE">            </span><span class="Token Identifier MacroDefine ID">X86_FEATURE_RDPID</span><span class="Token PPtoken COMMA">,</span><span class="Token PPtoken LF">
</span><span class="Token PPtoken SPACE">            </span><span class="Token PPtoken BraceDepth-2 LSQUAR_PAREN">[</span><span class="Token Identifier ID">p</span><span class="Token PPtoken BraceDepth-2 RSQUAR_PAREN">]</span><span class="Token PPtoken SPACE"> </span><span class="Token String STRING">&quot;=a&quot;</span><span class="Token SPACE"> </span><span class="Token PPtoken BraceDepth-2 LPAREN">(</span><span class="Token Identifier ID">p</span><span class="Token PPtoken BraceDepth-2 RPAREN">)</span><span class="Token PPtoken COMMA">,</span><span class="Token PPtoken SPACE"> </span><span class="Token PPtoken BraceDepth-2 LSQUAR_PAREN">[</span><span class="Token Identifier ID">seg</span><span class="Token PPtoken BraceDepth-2 RSQUAR_PAREN">]</span><span class="Token PPtoken SPACE"> </span><span class="Token String STRING">&quot;r&quot;</span><span class="Token SPACE"> </span><span class="Token PPtoken BraceDepth-2 LPAREN">(</span><span class="Token MacroDefine Identifier MacroDefine ID">__CPUNODE_SEG</span><span class="Token PPtoken BraceDepth-2 RPAREN">)</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token ExpressionStatement SEMI">;</span><span class="Token ExpressionStatement LF">
</span><span class="Token ExpressionStatement LF">
</span><span class="Token ExpressionStatement SPACE">    </span><span class="Token Keyword SelectionStatement IF">if</span><span class="Token Keyword SelectionStatement SPACE"> </span><span class="Token SelectionStatement BraceDepth-1 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">cpu</span><span class="Token SelectionStatement BraceDepth-1 RPAREN">)</span><span class="Token SelectionStatement LF">
</span><span class="Token SelectionStatement SPACE">        </span><span class="Token UnaryOp UnaryExpression POINTER">*</span><span class="Token Identifier PrimaryExpression ID">cpu</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token AssignOp AssignmentExpression ASSIGN">=</span><span class="Token AssignOp AssignmentExpression SPACE"> </span><span class="Token PrimaryExpression PostfixExpression BraceDepth-1 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">p</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token BinaryOp ConditionalExpression AMPERSAND">&amp;</span><span class="Token BinaryOp ConditionalExpression SPACE"> </span><span class="Token Identifier MacroDefine PrimaryExpression ID">VDSO_CPUNODE_MASK</span><span class="Token PrimaryExpression PostfixExpression BraceDepth-1 RPAREN">)</span><span class="Token ExpressionStatement SelectionStatement SEMI">;</span><span class="Token ExpressionStatement SelectionStatement LF">
</span><span class="Token ExpressionStatement SelectionStatement SPACE">    </span><span class="Token Keyword SelectionStatement IF">if</span><span class="Token Keyword SelectionStatement SPACE"> </span><span class="Token SelectionStatement BraceDepth-1 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">node</span><span class="Token SelectionStatement BraceDepth-1 RPAREN">)</span><span class="Token SelectionStatement LF">
</span><span class="Token SelectionStatement SPACE">        </span><span class="Token UnaryOp UnaryExpression POINTER">*</span><span class="Token Identifier PrimaryExpression ID">node</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token AssignOp AssignmentExpression ASSIGN">=</span><span class="Token AssignOp AssignmentExpression SPACE"> </span><span class="Token PrimaryExpression PostfixExpression BraceDepth-1 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">p</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token BinaryOp ConditionalExpression SHR">&gt;&gt;</span><span class="Token BinaryOp ConditionalExpression SPACE"> </span><span class="Token Identifier MacroDefine PrimaryExpression ID">VDSO_CPUNODE_BITS</span><span class="Token PrimaryExpression PostfixExpression BraceDepth-1 RPAREN">)</span><span class="Token ExpressionStatement SelectionStatement SEMI">;</span><span class="Token ExpressionStatement SelectionStatement LF">
</span><span class="Token CompoundStatement Function BraceDepth-0 RCURLY_BRACE">}</span></code></pre><h3 id="h3-6">VDSO 的构建</h3><p>vDSO image的构建过程比较复杂,下面是一个简要的过程描述:</p><ul><li>编译出组成vDSO image的三个目标文件:vdso-note.o vclock_gettime.o vgetcpu.o 这几个目标文件主要就是实现了以下几个快速系统调用的函数实现:<ul><li>clock_gettime()</li></ul><ul><li>gettimeofday()</li></ul><ul><li>time()</li></ul><ul><li>getcpu()</li></ul></li></ul><ul><li>使用专门定义的外部链接脚本vdso.lds生成raw vDSO image文件vdso64.so.dbg</li></ul><ul><li>调用objdump将vdso64.so.dbg strip为vdso64.so.</li></ul><ul><li>使用vdso2c工具将vdso64.so转换为vdso-image-64.c.vdso-image-64.c定义的是有关vdso64.so的各种blob信息,其中最重要一部分就是将vdso64.so的全部内容以C字节数组的形式放到了vdso-image-64.c中.</li></ul><ul><li>将vdso-image-64.c编译为vdso-image-64.o,并与内核中vDSO初始化相关的代码一起编译进内核.</li></ul><h3 id="h3-7">libc 调用 vsdo</h3><p>在内核加载ELF binary时,内核中的ELF loader会通过辅助向量来向用户态传递一些信息;而getauxval()就是用来通过辅助向量来获取这些信息的函数:</p><pre class="language-c"><code><span class="Token HASH">#</span><span class="Token Keyword Preprocess ControlLine INCLUDE">include</span><span class="Token Keyword Preprocess ControlLine SPACE"> </span><span class="Token HeaderName ControlLine BraceDepth-0 LANGLE_BRACE">&lt;</span><span class="Token String HeaderName STRING">sys/auxv.h</span><span class="Token HeaderName ControlLine BraceDepth-0 RANGLE_BRACE">&gt;</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token Keyword BaseType TypeSpecifier VOID">void</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token Identifier DirectDeclaractor ID">vdso</span><span class="Token Identifier DirectDeclaractor SPACE"> </span><span class="Token InitDeclarator ASSIGN">=</span><span class="Token InitDeclarator SPACE"> </span><span class="Token CastExpression ConditionalExpression BraceDepth-0 LPAREN">(</span><span class="Token Keyword Typedefine TypeSpecifier TYPEDEF_ID">uintptr_t</span><span class="Token CastExpression ConditionalExpression BraceDepth-0 RPAREN">)</span><span class="Token CastExpression ConditionalExpression SPACE"> </span><span class="Token Identifier PrimaryExpression FunctionCall ID">getauxval</span><span class="Token PostfixExpression UnaryExpression BraceDepth-0 LPAREN">(</span><span class="Token Identifier MacroDefine PrimaryExpression ID">AT_SYSINFO_EHDR</span><span class="Token PostfixExpression UnaryExpression BraceDepth-0 RPAREN">)</span><span class="Token Declaration SEMI">;</span></code></pre><p>辅助向量中的每个entry是一个键值对:key称作类型,value就是值.</p><p>与vDSO相关的辅助向量类型是 <code>AT_SYSINFO_EHDR</code>,该向量值保存了vDSO mapping的基地址.</p><p>当然,识别vDSO mapping只是第一步,伴随而来的是繁复的解析工作;这些工作通常由glibc来承担,应用程序只要还是按照传统方式直接调用C库即可</p><p>默认情况下,vDSO mapping总是开启;通过指定 <code>vdso=0</code> 来关闭vDSO mapping.</p><p>与vsyscall=native | emulate(默认值) | none选项共同配合,在定位与二进制兼容性相关的问题时,可以快速找出大体的问题方向.</p><h2 id="h2-8">vvar</h2><p>与vDSO mapping相伴的是一个叫vvar mapping的.vvar mapping的大小是8-12K,内容是vDSO mapping中的代码要访问的内核与用户进程之间要共享的数据.</p><p>进程启动时,vvar mapping的起始位置总是位于进程栈底之上的一个随机偏移(受ASLR实际配置的影响,比如randomize_va_space=1或2的情况);偏移值小于2M(PMD大小) - vvar mapping与vdso mapping的总和.</p><p>这样的算法就导致可以相对容易地根据进程的栈底的位置(该位置也是受ASLR的影响而随机创建的)/在最多2M地址空间内以4K为步长去probe.</p><h2 id="h2-9">性能测试</h2><pre class="language-c"><code><span class="Token HASH">#</span><span class="Token Keyword Preprocess ControlLine DEFINE">define</span><span class="Token Keyword Preprocess ControlLine SPACE"> </span><span class="Token Identifier MacroDefine ControlLine MacroDefine ID">_GNU_SOURCE</span><span class="Token LF">
</span><span class="Token HASH">#</span><span class="Token Keyword Preprocess ControlLine INCLUDE">include</span><span class="Token Keyword Preprocess ControlLine SPACE"> </span><span class="Token HeaderName ControlLine BraceDepth-0 LANGLE_BRACE">&lt;</span><span class="Token String HeaderName STRING">stdio.h</span><span class="Token HeaderName ControlLine BraceDepth-0 RANGLE_BRACE">&gt;</span><span class="Token LF">
</span><span class="Token HASH">#</span><span class="Token Keyword Preprocess ControlLine INCLUDE">include</span><span class="Token Keyword Preprocess ControlLine SPACE"> </span><span class="Token HeaderName ControlLine BraceDepth-0 LANGLE_BRACE">&lt;</span><span class="Token String HeaderName STRING">stdlib.h</span><span class="Token HeaderName ControlLine BraceDepth-0 RANGLE_BRACE">&gt;</span><span class="Token LF">
</span><span class="Token HASH">#</span><span class="Token Keyword Preprocess ControlLine INCLUDE">include</span><span class="Token Keyword Preprocess ControlLine SPACE"> </span><span class="Token HeaderName ControlLine BraceDepth-0 LANGLE_BRACE">&lt;</span><span class="Token String HeaderName STRING">string.h</span><span class="Token HeaderName ControlLine BraceDepth-0 RANGLE_BRACE">&gt;</span><span class="Token LF">
</span><span class="Token HASH">#</span><span class="Token Keyword Preprocess ControlLine INCLUDE">include</span><span class="Token Keyword Preprocess ControlLine SPACE"> </span><span class="Token HeaderName ControlLine BraceDepth-0 LANGLE_BRACE">&lt;</span><span class="Token String HeaderName STRING">sys/syscall.h</span><span class="Token HeaderName ControlLine BraceDepth-0 RANGLE_BRACE">&gt;</span><span class="Token LF">
</span><span class="Token HASH">#</span><span class="Token Keyword Preprocess ControlLine INCLUDE">include</span><span class="Token Keyword Preprocess ControlLine SPACE"> </span><span class="Token HeaderName ControlLine BraceDepth-0 LANGLE_BRACE">&lt;</span><span class="Token String HeaderName STRING">time.h</span><span class="Token HeaderName ControlLine BraceDepth-0 RANGLE_BRACE">&gt;</span><span class="Token LF">
</span><span class="Token HASH">#</span><span class="Token Keyword Preprocess ControlLine INCLUDE">include</span><span class="Token Keyword Preprocess ControlLine SPACE"> </span><span class="Token HeaderName ControlLine BraceDepth-0 LANGLE_BRACE">&lt;</span><span class="Token String HeaderName STRING">unistd.h</span><span class="Token HeaderName ControlLine BraceDepth-0 RANGLE_BRACE">&gt;</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token Keyword BaseType TypeSpecifier FunctionReturnType INT">int</span><span class="Token Keyword BaseType TypeSpecifier FunctionReturnType SPACE"> </span><span class="Token Identifier DirectDeclaractor FunctionName FunctionName ID">main</span><span class="Token DirectDeclaractor Declarator BraceDepth-0 LPAREN">(</span><span class="Token Keyword BaseType TypeSpecifier INT">int</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Identifier DirectDeclaractor ID">argc</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token Keyword BaseType TypeSpecifier CHAR">char</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token Pointer Declarator POINTER">*</span><span class="Token Identifier DirectDeclaractor ID">argv</span><span class="Token DirectDeclaractor Declarator BraceDepth-0 RPAREN">)</span><span class="Token DirectDeclaractor Declarator SPACE"> </span><span class="Token CompoundStatement Function BraceDepth-0 LCURLY_BRACE">{</span><span class="Token CompoundStatement Function LF">
</span><span class="Token CompoundStatement Function SPACE">    </span><span class="Token Keyword BaseType TypeSpecifier UNSIGNED">unsigned</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Keyword BaseType TypeSpecifier LONG">long</span><span class="Token Keyword BaseType TypeSpecifier SPACE"> </span><span class="Token Identifier DirectDeclaractor ID">i</span><span class="Token Identifier DirectDeclaractor SPACE"> </span><span class="Token InitDeclarator ASSIGN">=</span><span class="Token InitDeclarator SPACE"> </span><span class="Token Constant PrimaryExpression NUMBER">0</span><span class="Token Declaration SEMI">;</span><span class="Token Declaration LF">
</span><span class="Token Declaration SPACE">    </span><span class="Token Identifier PrimaryExpression Typedefine TYPEDEF_ID">time_t</span><span class="Token Identifier PrimaryExpression Typedefine SPACE"> </span><span class="Token PostfixExpression UnaryExpression BraceDepth-1 LPAREN">(</span><span class="Token UnaryOp UnaryExpression POINTER">*</span><span class="Token Identifier PrimaryExpression FunctionP ID">f</span><span class="Token PostfixExpression UnaryExpression BraceDepth-1 RPAREN">)</span><span class="Token PostfixExpression UnaryExpression BraceDepth-1 LPAREN">(</span><span class="Token Keyword Typedefine TypeSpecifier TYPEDEF_ID">time_t</span><span class="Token Keyword Typedefine TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token PostfixExpression UnaryExpression BraceDepth-1 RPAREN">)</span><span class="Token PostfixExpression UnaryExpression SPACE"> </span><span class="Token AssignOp AssignmentExpression ASSIGN">=</span><span class="Token AssignOp AssignmentExpression SPACE"> </span><span class="Token CastExpression ConditionalExpression BraceDepth-1 LPAREN">(</span><span class="Token Keyword Typedefine TypeSpecifier TYPEDEF_ID">time_t</span><span class="Token DirectAbstractDeclaractorPostfix BraceDepth-2 LPAREN">(</span><span class="Token Pointer AbstractDeclarator POINTER">*</span><span class="Token DirectAbstractDeclaractorPostfix BraceDepth-2 RPAREN">)</span><span class="Token DirectAbstractDeclaractorPostfix BraceDepth-2 LPAREN">(</span><span class="Token Keyword Typedefine TypeSpecifier TYPEDEF_ID">time_t</span><span class="Token Keyword Typedefine TypeSpecifier SPACE"> </span><span class="Token Pointer Declarator POINTER">*</span><span class="Token DirectAbstractDeclaractorPostfix BraceDepth-2 RPAREN">)</span><span class="Token CastExpression ConditionalExpression BraceDepth-1 RPAREN">)</span><span class="Token Constant PrimaryExpression NUMBER">0xffffffffff600400UL</span><span class="Token ExpressionStatement SEMI">;</span><span class="Token ExpressionStatement LF">
</span><span class="Token ExpressionStatement LF">
</span><span class="Token ExpressionStatement SPACE">    </span><span class="Token Keyword SelectionStatement IF">if</span><span class="Token Keyword SelectionStatement SPACE"> </span><span class="Token SelectionStatement BraceDepth-1 LPAREN">(</span><span class="Token UnaryOp UnaryExpression BANG">!</span><span class="Token Identifier PrimaryExpression FunctionCall ID">strcmp</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">argv</span><span class="Token PostfixExpression UnaryExpression BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token Constant PrimaryExpression NUMBER">1</span><span class="Token PostfixExpression UnaryExpression BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token PostfixExpression UnaryExpression COMMA">,</span><span class="Token PostfixExpression UnaryExpression SPACE"> </span><span class="Token String STRING">&quot;vsyscall&quot;</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 RPAREN">)</span><span class="Token SelectionStatement BraceDepth-1 RPAREN">)</span><span class="Token SelectionStatement SPACE"> </span><span class="Token CompoundStatement SelectionStatement BraceDepth-1 LCURLY_BRACE">{</span><span class="Token CompoundStatement SelectionStatement LF">
</span><span class="Token CompoundStatement SelectionStatement SPACE">        </span><span class="Token Keyword IterationStatement FOR">for</span><span class="Token Keyword IterationStatement SPACE"> </span><span class="Token IterationStatement BraceDepth-2 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">i</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token AssignOp AssignmentExpression ASSIGN">=</span><span class="Token AssignOp AssignmentExpression SPACE"> </span><span class="Token Constant PrimaryExpression NUMBER">0</span><span class="Token IterationStatement SEMI">;</span><span class="Token IterationStatement SPACE"> </span><span class="Token Identifier PrimaryExpression ID">i</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token BinaryOp ConditionalExpression LT">&lt;</span><span class="Token BinaryOp ConditionalExpression SPACE"> </span><span class="Token Constant PrimaryExpression NUMBER">1000000</span><span class="Token IterationStatement SEMI">;</span><span class="Token IterationStatement SPACE"> </span><span class="Token UnaryOp UnaryExpression INC">++</span><span class="Token Identifier PrimaryExpression ID">i</span><span class="Token IterationStatement BraceDepth-2 RPAREN">)</span><span class="Token IterationStatement SPACE"> </span><span class="Token Identifier PrimaryExpression FunctionCall ID">f</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 LPAREN">(</span><span class="Token Identifier MacroDefine PrimaryExpression ID">NULL</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 RPAREN">)</span><span class="Token ExpressionStatement IterationStatement SEMI">;</span><span class="Token ExpressionStatement IterationStatement LF">
</span><span class="Token ExpressionStatement IterationStatement SPACE">    </span><span class="Token CompoundStatement SelectionStatement BraceDepth-1 RCURLY_BRACE">}</span><span class="Token CompoundStatement SelectionStatement SPACE"> </span><span class="Token Keyword SelectionStatement ELSE">else</span><span class="Token Keyword SelectionStatement SPACE"> </span><span class="Token Keyword SelectionStatement IF">if</span><span class="Token Keyword SelectionStatement SPACE"> </span><span class="Token SelectionStatement SelectionStatement BraceDepth-1 LPAREN">(</span><span class="Token UnaryOp UnaryExpression BANG">!</span><span class="Token Identifier PrimaryExpression FunctionCall ID">strcmp</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">argv</span><span class="Token PostfixExpression UnaryExpression BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token Constant PrimaryExpression NUMBER">1</span><span class="Token PostfixExpression UnaryExpression BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token PostfixExpression UnaryExpression COMMA">,</span><span class="Token PostfixExpression UnaryExpression SPACE"> </span><span class="Token String STRING">&quot;vdso&quot;</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 RPAREN">)</span><span class="Token SelectionStatement SelectionStatement BraceDepth-1 RPAREN">)</span><span class="Token SelectionStatement SelectionStatement SPACE"> </span><span class="Token CompoundStatement SelectionStatement BraceDepth-1 LCURLY_BRACE">{</span><span class="Token CompoundStatement SelectionStatement LF">
</span><span class="Token CompoundStatement SelectionStatement SPACE">        </span><span class="Token Keyword IterationStatement FOR">for</span><span class="Token Keyword IterationStatement SPACE"> </span><span class="Token IterationStatement BraceDepth-2 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">i</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token AssignOp AssignmentExpression ASSIGN">=</span><span class="Token AssignOp AssignmentExpression SPACE"> </span><span class="Token Constant PrimaryExpression NUMBER">0</span><span class="Token IterationStatement SEMI">;</span><span class="Token IterationStatement SPACE"> </span><span class="Token Identifier PrimaryExpression ID">i</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token BinaryOp ConditionalExpression LT">&lt;</span><span class="Token BinaryOp ConditionalExpression SPACE"> </span><span class="Token Constant PrimaryExpression NUMBER">1000000</span><span class="Token IterationStatement SEMI">;</span><span class="Token IterationStatement SPACE"> </span><span class="Token UnaryOp UnaryExpression INC">++</span><span class="Token Identifier PrimaryExpression ID">i</span><span class="Token IterationStatement BraceDepth-2 RPAREN">)</span><span class="Token IterationStatement SPACE"> </span><span class="Token Identifier PrimaryExpression FunctionCall ID">time</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 LPAREN">(</span><span class="Token Identifier MacroDefine PrimaryExpression ID">NULL</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 RPAREN">)</span><span class="Token ExpressionStatement IterationStatement SEMI">;</span><span class="Token ExpressionStatement IterationStatement LF">
</span><span class="Token ExpressionStatement IterationStatement SPACE">    </span><span class="Token CompoundStatement SelectionStatement BraceDepth-1 RCURLY_BRACE">}</span><span class="Token CompoundStatement SelectionStatement SPACE"> </span><span class="Token Keyword SelectionStatement ELSE">else</span><span class="Token Keyword SelectionStatement SPACE"> </span><span class="Token CompoundStatement SelectionStatement BraceDepth-1 LCURLY_BRACE">{</span><span class="Token CompoundStatement SelectionStatement LF">
</span><span class="Token CompoundStatement SelectionStatement SPACE">        </span><span class="Token Keyword IterationStatement FOR">for</span><span class="Token Keyword IterationStatement SPACE"> </span><span class="Token IterationStatement BraceDepth-2 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">i</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token AssignOp AssignmentExpression ASSIGN">=</span><span class="Token AssignOp AssignmentExpression SPACE"> </span><span class="Token Constant PrimaryExpression NUMBER">0</span><span class="Token IterationStatement SEMI">;</span><span class="Token IterationStatement SPACE"> </span><span class="Token Identifier PrimaryExpression ID">i</span><span class="Token Identifier PrimaryExpression SPACE"> </span><span class="Token BinaryOp ConditionalExpression LT">&lt;</span><span class="Token BinaryOp ConditionalExpression SPACE"> </span><span class="Token Constant PrimaryExpression NUMBER">1000000</span><span class="Token IterationStatement SEMI">;</span><span class="Token IterationStatement SPACE"> </span><span class="Token UnaryOp UnaryExpression INC">++</span><span class="Token Identifier PrimaryExpression ID">i</span><span class="Token IterationStatement BraceDepth-2 RPAREN">)</span><span class="Token IterationStatement SPACE"> </span><span class="Token Identifier PrimaryExpression FunctionCall ID">syscall</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 LPAREN">(</span><span class="Token Identifier PrimaryExpression ID">SYS_time</span><span class="Token PostfixExpression UnaryExpression COMMA">,</span><span class="Token PostfixExpression UnaryExpression SPACE"> </span><span class="Token Identifier MacroDefine PrimaryExpression ID">NULL</span><span class="Token PostfixExpression UnaryExpression BraceDepth-2 RPAREN">)</span><span class="Token ExpressionStatement IterationStatement SEMI">;</span><span class="Token ExpressionStatement IterationStatement LF">
</span><span class="Token ExpressionStatement IterationStatement SPACE">    </span><span class="Token CompoundStatement SelectionStatement BraceDepth-1 RCURLY_BRACE">}</span><span class="Token CompoundStatement SelectionStatement LF">
</span><span class="Token CompoundStatement SelectionStatement LF">
</span><span class="Token CompoundStatement SelectionStatement SPACE">    </span><span class="Token Keyword JumpStatement RETURN">return</span><span class="Token Keyword JumpStatement SPACE"> </span><span class="Token Constant PrimaryExpression NUMBER">0</span><span class="Token JumpStatement SEMI">;</span><span class="Token JumpStatement LF">
</span><span class="Token CompoundStatement Function BraceDepth-0 RCURLY_BRACE">}</span></code></pre><p>笔者当前的内核没有 vsyscall 页面的映射</p><pre class="language-shell"><code><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token Program ID">base</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token HOST_NAME">kamilu@LZX</span><span class="Token COLON">:</span><span class="Token DIR_PATH">~</span><span class="Token TAG">$</span><span class="Token SPACE"> </span><span class="Token Program ID">time</span><span class="Token SPACE"> </span><span class="Token PATH">./a.out</span><span class="Token SPACE"> </span><span class="Token ID">vsyscall</span><span class="Token LF">
</span><span class="Token Program ID">Segmentation</span><span class="Token SPACE"> </span><span class="Token ID">fault</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token Program ID">real</span><span class="Token SPACE">    </span><span class="Token NUMBER">0</span><span class="Token ID">m0.007s</span><span class="Token LF">
</span><span class="Token Program ID">user</span><span class="Token SPACE">    </span><span class="Token NUMBER">0</span><span class="Token ID">m0.000s</span><span class="Token LF">
</span><span class="Token Program ID">sys</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token ID">m0.007s</span><span class="Token LF">
</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token Program ID">base</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token HOST_NAME">kamilu@LZX</span><span class="Token COLON">:</span><span class="Token DIR_PATH">~</span><span class="Token TAG">$</span><span class="Token SPACE"> </span><span class="Token Program ID">time</span><span class="Token SPACE"> </span><span class="Token PATH">./a.out</span><span class="Token SPACE"> </span><span class="Token ID">vdso</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token Program ID">real</span><span class="Token SPACE">    </span><span class="Token NUMBER">0</span><span class="Token ID">m0.002s</span><span class="Token LF">
</span><span class="Token Program ID">user</span><span class="Token SPACE">    </span><span class="Token NUMBER">0</span><span class="Token ID">m0.002s</span><span class="Token LF">
</span><span class="Token Program ID">sys</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token ID">m0.000s</span><span class="Token LF">
</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token Program ID">base</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token HOST_NAME">kamilu@LZX</span><span class="Token COLON">:</span><span class="Token DIR_PATH">~</span><span class="Token TAG">$</span><span class="Token SPACE"> </span><span class="Token Program ID">time</span><span class="Token SPACE"> </span><span class="Token PATH">./a.out</span><span class="Token SPACE"> </span><span class="Token ID">vsyscall-native</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token Program ID">real</span><span class="Token SPACE">    </span><span class="Token NUMBER">0</span><span class="Token ID">m0.045s</span><span class="Token LF">
</span><span class="Token Program ID">user</span><span class="Token SPACE">    </span><span class="Token NUMBER">0</span><span class="Token ID">m0.035s</span><span class="Token LF">
</span><span class="Token Program ID">sys</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token ID">m0.009s</span></code></pre><p>从测试结果来看, <code>vDSO</code> &gt; <code>syscall</code> == <code>native vsyscall</code> &gt; <code>emulated vsyscall</code>.其中:</p><ul><li>上面的vsyscall的结果是emulate模式的,也是内核默认的设置,原因是native vsyscall存在安全缺陷</li></ul><ul><li>native模式的性能与直接调用C函数几乎一致,因为原理上都是执行syscall指令</li></ul><ul><li>vDSO兼具安全性和高性能</li></ul><p>注意:可以通过内核命令行参数 <code>vsyscall=native|emulate(默认值)</code> 来设置vsyscall的运行模式</p><h2 id="h2-10">参考</h2><h3 id="h3-11">VSDO</h3><ul><li><a href="https://man7.org/linux/man-pages/man7/vdso.7.html" target="_blank">man7 vdso.7</a></li></ul><ul><li><a href="https://zhuanlan.zhihu.com/p/436454953" target="_blank">Linux vDSO概述</a></li></ul><ul><li><a href="https://blog.csdn.net/JuanA1/article/details/6904932" target="_blank">Linux内核特性之VDSO</a></li></ul><ul><li><a href="https://0xax.gitbooks.io/linux-insides/content/SysCall/linux-syscall-3.html" target="_blank">System calls in the Linux kernel. Part 3.</a></li></ul><ul><li><a href="https://terenceli.github.io/%E6%8A%80%E6%9C%AF/2019/02/13/vsyscall-and-vdso" target="_blank">vsyscall-and-vdso</a></li></ul><h3 id="h3-12">ASLR</h3><ul><li><a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization" target="_blank">Address space layout randomization</a></li></ul><ul><li><a href="https://lwn.net/Articles/569635/" target="_blank">Kernel address space layout randomization</a></li></ul></div>
    <div class="dir-tree"><ul><li><a href="../../md-docs/README" >README</a></li></ul><ul><li><a href="../../快速开始/编译内核" >快速开始</a><ul><li><a href="../../快速开始/编译内核" >编译内核</a></li></ul><ul><li><a href="../../快速开始/调试内核" >调试内核</a></li></ul><ul><li><a href="../../快速开始/制作linux发行版" >制作linux发行版</a></li></ul><ul><li><a href="../../快速开始/邮件订阅" >邮件订阅</a></li></ul><ul><li><a href="../../快速开始/patch" >patch</a></li></ul></li></ul><ul><li><a href="../../mm/detect" >mm</a><ul><li><a href="../../mm/detect" >detect</a></li></ul><ul><li><a href="../../mm/va_trans" >va_trans</a></li></ul><ul><li><a href="../../mm/numa" >numa</a></li></ul><ul><li><a href="../../mm/buddy" >buddy</a></li></ul><ul><li><a href="../../mm/slab" >slab</a></li></ul><ul><li><a href="../../mm/compaction" >compaction</a></li></ul><ul><li><a href="../../mm/tier" >tier</a></li></ul><ul><li><a href="../../mm/migration" >migration</a></li></ul><ul><li><a href="../../mm/mm_struct" >mm_struct</a></li></ul><ul><li><a href="../../mm/mmio" >mmio</a></li></ul></li></ul><ul><li><a href="../../fs/storage" >fs</a><ul><li><a href="../../fs/storage" >storage</a></li></ul><ul><li><a href="../../fs/filesystem" >filesystem</a></li></ul><ul><li><a href="../../fs/fd" >fd</a></li></ul><ul><li><a href="../../fs/inode" >inode</a></li></ul><ul><li><a href="../../fs/directory" >directory</a></li></ul><ul><li><a href="../../fs/disk-layout" >disk-layout</a></li></ul><ul><li><a href="../../fs/mount" >mount</a></li></ul><ul><li><a href="../../fs/vfs" >vfs</a></li></ul><ul><li><a href="../../fs/ext4" >ext4</a></li></ul><ul><li><a href="../../fs/fuse" >fuse</a></li></ul><ul><li><a href="../../fs/distribute-fs" >distribute-fs</a></li></ul></li></ul><ul><li><a href="../../runtime/proc" >runtime</a><ul><li><a href="../../runtime/proc" >proc</a></li></ul><ul><li><a href="../../runtime/vsdo" >vsdo</a></li></ul><ul><li><a href="../../runtime/elf_format" >elf_format</a></li></ul><ul><li><a href="../../runtime/elf_loader" >elf_loader</a></li></ul><ul><li><a href="../../runtime/ld" >ld</a></li></ul></li></ul><ul><li><a href="../../kernel/init" >kernel</a><ul><li><a href="../../kernel/init" >init</a></li></ul><ul><li><a href="../../kernel/atomic" >atomic</a></li></ul><ul><li><a href="../../kernel/rcu" >rcu</a></li></ul><ul><li><a href="../../kernel/workqueue" >workqueue</a></li></ul><ul><li><a href="../../kernel/lock" >lock</a></li></ul></li></ul><ul><li><a href="../../arch/cpu" >arch</a><ul><li><a href="../../arch/cpu" >cpu</a></li></ul><ul><li><a href="../../arch/cache" >cache</a></li></ul><ul><li><a href="../../arch/multicore" >multicore</a></li></ul><ul><li><a href="../../arch/cache-co" >cache-co</a></li></ul><ul><li><a href="../../arch/memory-co" >memory-co</a></li></ul><ul><li><a href="../../arch/bus" >bus</a></li></ul><ul><li><a href="../../arch/interrupt" >interrupt</a></li></ul></li></ul><ul><li><a href="../../proc/schedule" >proc</a><ul><li><a href="../../proc/schedule" >schedule</a></li></ul><ul><li><a href="../../proc/nice" >nice</a></li></ul><ul><li><a href="../../proc/manage" >manage</a></li></ul><ul><li><a href="../../proc/signal" >signal</a></li></ul><ul><li><a href="../../proc/cgroup" >cgroup</a></li></ul><ul><li><a href="../../proc/task_struct" >task_struct</a></li></ul><ul><li><a href="../../proc/rb-tree" >rb-tree</a></li></ul></li></ul><ul><li><a href="../../device/io" >device</a><ul><li><a href="../../device/io" >io</a></li></ul><ul><li><a href="../../device/disk" >disk</a></li></ul><ul><li><a href="../../device/ssd" >ssd</a></li></ul><ul><li><a href="../../device/driver" >driver</a></li></ul><ul><li><a href="../../device/io_uring" >io_uring</a></li></ul></li></ul><ul><li><a href="../../others/safety" >others</a><ul><li><a href="../../others/safety" >safety</a></li></ul><ul><li><a href="../../others/Q&A" >Q&A</a></li></ul></li></ul><ul><li><a href="../../driver/intro" >driver</a><ul><li><a href="../../driver/intro" >intro</a></li></ul><ul><li><a href="../../driver/usb" >usb</a></li></ul><ul><li><a href="../../driver/pcie" >pcie</a></li></ul></li></ul><ul><li><a href="../../cve/dirtycow" >cve</a><ul><li><a href="../../cve/dirtycow" >dirtycow</a></li></ul><ul><li><a href="../../cve/dirtypipe" >dirtypipe</a></li></ul><ul><li><a href="../../cve/sudo" >sudo</a></li></ul><ul><li><a href="../../cve/meltdown" >meltdown</a></li></ul><ul><li><a href="../../cve/smashex" >smashex</a></li></ul></li></ul></div>
    <div class="zood"><a class="" href="https://github.com/luzhixing12345/zood" target="_blank">zood</a></div>
    <script type="text/javascript" src="../../../js/next_front.js"></script><script>addLink("../../runtime/proc","../../runtime/elf_format","ab")</script><script type="text/javascript" src="../../../js/change_mode.js"></script><script>addChangeModeButton("../../../img/sun.png","../../../img/moon.png")</script><script type="text/javascript" src="../../../js/copy_code.js"></script><script>addCodeCopy("../../../img/before_copy.png","../../../img/after_copy.png")</script><script type="text/javascript" src="../../../js/navigator.js"></script><script type="text/javascript" src="../../../js/picture_preview.js"></script><script type="text/javascript" src="../../../js/global_js_configuration.js"></script>
</body>

</html>